<!DOCTYPE html>
<!-- 
  Dashboard Versie: 24.1 - CMS met Volledige Content Import
  Changelog:
  - De 'handleInitialImport' functie bevat nu de volledige Markdown-content van de drie bestaande artikelen.
  - De placeholder-tekst is vervangen, zodat de artikelen na de eenmalige import direct volledig zijn.
-->
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voetbaltrainers Data Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, addDoc, deleteDoc, orderBy, query, writeBatch, where, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-functions.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDZckphHLQiTK2KZHPOyPDxgB6glBr4HpY",
            authDomain: "voetbaltrainers.firebaseapp.com",
            projectId: "voetbaltrainers",
            storageBucket: "voetbaltrainers.appspot.com",
            messagingSenderId: "640532231483",
            appId: "1:640532231483:web:54d614b65b3e2c4adc731e",
            measurementId: "G-YQV6E3V2CK"
        };
        
        const app = initializeApp(firebaseConfig);
        const functions = getFunctions(app, 'europe-west1');

        window.firebaseServices = {
            auth: getAuth(app),
            db: getFirestore(app),
            functions: {
                enrichCoachData: httpsCallable(functions, 'enrichCoachData')
            },
            GoogleAuthProvider,
            signInWithPopup,
            signOut,
            onAuthStateChanged,
            collection, getDocs, doc, updateDoc, addDoc, deleteDoc, orderBy, query, writeBatch, where, getDoc, serverTimestamp
        };
    </script>
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;
        const { db, auth, functions, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, collection, getDocs, doc, updateDoc, addDoc, deleteDoc, orderBy, query, writeBatch, where, getDoc, serverTimestamp } = window.firebaseServices;

        // --- ICONEN ---
        const DatabaseIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>;
        const UserIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>;
        const UploadIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
        const LogOutIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" x2="9" y1="12" y2="12"></line></svg>;
        const ListIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg>;
        const ToolIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>;
        const ChartBarIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><line x1="12" x2="12" y1="20" y2="10"></line><line x1="18" x2="18" y1="20" y2="4"></line><line x1="6" x2="6" y1="20" y2="16"></line></svg>;
        const AvatarIcon = () => <span className="inline-block h-10 w-10 rounded-full overflow-hidden bg-gray-100"><svg className="h-full w-full text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M24 20.993V24H0v-2.997A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" /></svg></span>;
        const EditIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>;
        const DeleteIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const SaveIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
        const CancelIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const AddIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const ImageIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>;
        const CopyIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>;
        const ArticleIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>;

        // --- COMPONENTEN ---

        function ClubsView({ initialClubs, onUpdate }) {
            const [clubs, setClubs] = useState(initialClubs);
            const [editingRowId, setEditingRowId] = useState(null);
            const [editedData, setEditedData] = useState({});
            const [newClub, setNewClub] = useState({ naam: '', land: '', logo_url: '' });
            const [isLoading, setIsLoading] = useState(false);
            const [filters, setFilters] = useState({ land: '', zoekterm: '' });

            useEffect(() => { setClubs(initialClubs); }, [initialClubs]);
            
            const uniqueLands = useMemo(() => [...new Set(initialClubs.map(c => c.land))].sort(), [initialClubs]);

            const filteredClubs = useMemo(() => {
                return clubs.filter(club => {
                    const landMatch = filters.land ? club.land === filters.land : true;
                    const searchMatch = filters.zoekterm ? club.naam.toLowerCase().includes(filters.zoekterm.toLowerCase()) : true;
                    return landMatch && searchMatch;
                });
            }, [clubs, filters]);

            const handleEditClick = (club) => {
                setEditingRowId(club.id);
                setEditedData({ ...club });
            };

            const handleCancelClick = () => {
                setEditingRowId(null);
                setEditedData({});
            };

            const handleSaveClick = async (clubId) => {
                setIsLoading(true);
                try {
                    const { id, ...dataToSave } = editedData;
                    await updateDoc(doc(db, "clubs", clubId), dataToSave);
                    setEditingRowId(null);
                    onUpdate();
                } catch (e) {
                    console.error("Fout bij opslaan club:", e);
                    alert("Kon de club niet opslaan.");
                } finally {
                    setIsLoading(false);
                }
            };
            
            const handleAddClub = async (e) => {
                e.preventDefault();
                if(!newClub.naam || !newClub.land) {
                    alert("Clubnaam en land zijn verplicht.");
                    return;
                }
                setIsLoading(true);
                try {
                    await addDoc(collection(db, "clubs"), newClub);
                    setNewClub({ naam: '', land: '', logo_url: '' });
                    onUpdate();
                } catch (e) {
                    console.error("Fout bij toevoegen club:", e);
                    alert("Kon de club niet toevoegen.");
                } finally {
                    setIsLoading(false);
                }
            };

            const handleDelete = async (clubId) => {
                if (!confirm(`Weet je zeker dat je deze club wilt verwijderen? Alle bijbehorende seizoenen worden ook verwijderd!`)) return;
                setIsLoading(true);
                try {
                    const seasonsQuery = query(collection(db, "seizoenen"), where("club", "==", clubId));
                    const seasonsSnapshot = await getDocs(seasonsQuery);
                    const batch = writeBatch(db);
                    seasonsSnapshot.forEach(doc => batch.delete(doc.ref));
                    batch.delete(doc(db, "clubs", clubId));
                    await batch.commit();
                    onUpdate();
                } catch (e) {
                     console.error("Fout bij verwijderen club:", e);
                    alert("Kon de club niet verwijderen.");
                } finally {
                    setIsLoading(false);
                }
            };

            const handleInputChange = (e) => setEditedData({ ...editedData, [e.target.name]: e.target.value });
            const handleNewClubChange = (e) => setNewClub({ ...newClub, [e.target.name]: e.target.value });
            const handleFilterChange = (e) => setFilters({ ...filters, [e.target.name]: e.target.value });

            return (
                <div className="bg-white p-6 rounded-lg shadow space-y-6">
                    <h2 className="text-xl font-bold">Clubs ({filteredClubs.length} / {clubs.length})</h2>
                    
                    <form onSubmit={handleAddClub} className="p-4 border rounded-lg bg-gray-50 space-y-3">
                        <h3 className="font-semibold text-lg">Nieuwe Club Toevoegen</h3>
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <input type="text" name="naam" value={newClub.naam} onChange={handleNewClubChange} placeholder="Clubnaam" className="p-2 border rounded col-span-1" required />
                            <input type="text" name="land" value={newClub.land} onChange={handleNewClubChange} placeholder="Land" className="p-2 border rounded col-span-1" required />
                            <input type="text" name="logo_url" value={newClub.logo_url} onChange={handleNewClubChange} placeholder="Logo URL" className="p-2 border rounded col-span-2" />
                        </div>
                        <button type="submit" disabled={isLoading} className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-gray-400 flex items-center gap-2">
                            <AddIcon /> {isLoading ? 'Bezig...' : 'Toevoegen'}
                        </button>
                    </form>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 border rounded-lg bg-gray-50">
                        <input type="text" name="zoekterm" value={filters.zoekterm} onChange={handleFilterChange} placeholder="Zoek op clubnaam..." className="p-2 border rounded" />
                        <select name="land" value={filters.land} onChange={handleFilterChange} className="p-2 border rounded">
                            <option value="">Alle Landen</option>
                            {uniqueLands.map(l => <option key={l} value={l}>{l}</option>)}
                        </select>
                    </div>

                    <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Logo</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Naam</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Land</th>
                                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acties</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {filteredClubs.map(club => (
                                    editingRowId === club.id ? (
                                    <tr key={club.id}>
                                        <td className="px-6 py-4"><input type="text" name="logo_url" value={editedData.logo_url} onChange={handleInputChange} className="p-1 border rounded w-full" /></td>
                                        <td className="px-6 py-4"><input type="text" name="naam" value={editedData.naam} onChange={handleInputChange} className="p-1 border rounded w-full" /></td>
                                        <td className="px-6 py-4"><input type="text" name="land" value={editedData.land} onChange={handleInputChange} className="p-1 border rounded w-full" /></td>
                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button onClick={() => handleSaveClick(club.id)} disabled={isLoading} className="text-green-600 hover:text-green-900"><SaveIcon /></button>
                                            <button onClick={handleCancelClick} className="text-gray-600 hover:text-gray-900 ml-2"><CancelIcon /></button>
                                        </td>
                                    </tr>
                                    ) : (
                                    <tr key={club.id}>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            {club.logo_url ? <img src={club.logo_url} alt={club.naam} className="h-8 w-8" onError={(e) => e.target.style.display='none'} /> : ''}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap">{club.naam}</td>
                                        <td className="px-6 py-4 whitespace-nowrap">{club.land}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button onClick={() => handleEditClick(club)} className="text-indigo-600 hover:text-indigo-900"><EditIcon /></button>
                                            <button onClick={() => handleDelete(club.id)} disabled={isLoading} className="text-red-600 hover:text-red-900 ml-2"><DeleteIcon /></button>
                                        </td>
                                    </tr>
                                    )
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        function CoachesView({ initialCoaches, onUpdate }) {
            const [coaches, setCoaches] = useState(initialCoaches);
            const [editingRowId, setEditingRowId] = useState(null);
            const [editedData, setEditedData] = useState({});
            const [newCoach, setNewCoach] = useState({ naam: '', nationaliteit: '', nat_code: '', foto_url: '' });
            const [isLoading, setIsLoading] = useState(false);
            const [isEnriching, setIsEnriching] = useState(false);
            const [enrichStatus, setEnrichStatus] = useState('');
            const [filters, setFilters] = useState({ nationaliteit: '', zoekterm: '' });

            useEffect(() => { setCoaches(initialCoaches); }, [initialCoaches]);

            const uniqueNationalities = useMemo(() => [...new Set(initialCoaches.map(c => c.nationaliteit).filter(Boolean))].sort(), [initialCoaches]);

            const filteredCoaches = useMemo(() => {
                return coaches.filter(coach => {
                    const natMatch = filters.nationaliteit ? coach.nationaliteit === filters.nationaliteit : true;
                    const searchMatch = filters.zoekterm ? coach.naam.toLowerCase().includes(filters.zoekterm.toLowerCase()) : true;
                    return natMatch && searchMatch;
                });
            }, [coaches, filters]);

            const handleFindMissingImages = async () => {
                const coachesToEnrich = coaches.filter(c => !c.foto_url);
                if (coachesToEnrich.length === 0) {
                    setEnrichStatus("Alle coaches hebben al een afbeelding.");
                    setTimeout(() => setEnrichStatus(''), 3000);
                    return;
                }
                
                setIsEnriching(true);
                setEnrichStatus(`Zoeken naar afbeeldingen voor ${coachesToEnrich.length} coaches...`);
                
                try {
                    const namesToEnrich = coachesToEnrich.map(c => c.naam);
                    const result = await functions.enrichCoachData({ coaches: namesToEnrich });
                    const enrichedData = new Map(result.data.coaches.map(c => [c.naam, c.foto_url]));

                    const batch = writeBatch(db);
                    let updatedCount = 0;
                    
                    coachesToEnrich.forEach(coach => {
                        const newUrl = enrichedData.get(coach.naam);
                        if (newUrl) {
                            const coachRef = doc(db, "coaches", coach.id);
                            batch.update(coachRef, { foto_url: newUrl });
                            updatedCount++;
                        }
                    });

                    if (updatedCount > 0) {
                        await batch.commit();
                        setEnrichStatus(`${updatedCount} afbeelding(en) gevonden en bijgewerkt. Data wordt herladen.`);
                        onUpdate();
                    } else {
                        setEnrichStatus("Geen nieuwe afbeeldingen gevonden.");
                    }

                } catch (error) {
                    console.error("Fout bij verrijken afbeeldingen:", error);
                    setEnrichStatus("Er is een fout opgetreden.");
                } finally {
                    setIsEnriching(false);
                    setTimeout(() => setEnrichStatus(''), 5000);
                }
            };

            const handleEditClick = (coach) => {
                setEditingRowId(coach.id);
                setEditedData({ ...coach });
            };

            const handleCancelClick = () => {
                setEditingRowId(null);
                setEditedData({});
            };

            const handleSaveClick = async (coachId) => {
                setIsLoading(true);
                try {
                    const { id, ...dataToSave } = editedData;
                    await updateDoc(doc(db, "coaches", coachId), dataToSave);
                    setEditingRowId(null);
                    onUpdate();
                } catch (e) {
                    console.error("Fout bij opslaan coach:", e);
                    alert("Kon de coach niet opslaan.");
                } finally {
                    setIsLoading(false);
                }
            };
            
            const handleAddCoach = async (e) => {
                e.preventDefault();
                if(!newCoach.naam) {
                    alert("Naam is verplicht.");
                    return;
                }
                setIsLoading(true);
                try {
                    await addDoc(collection(db, "coaches"), newCoach);
                    setNewCoach({ naam: '', nationaliteit: '', nat_code: '', foto_url: '' });
                    onUpdate();
                } catch (e) {
                    console.error("Fout bij toevoegen coach:", e);
                    alert("Kon de coach niet toevoegen.");
                } finally {
                    setIsLoading(false);
                }
            };

            const handleDelete = async (coachId) => {
                setIsLoading(true);
                try {
                    const seasonsQuery = query(collection(db, "seizoenen"), where("coachId", "==", coachId));
                    const seasonsSnapshot = await getDocs(seasonsQuery);
                    if (!seasonsSnapshot.empty) {
                        alert(`Kan coach niet verwijderen. De coach is nog gekoppeld aan ${seasonsSnapshot.size} seizoen(en).`);
                        setIsLoading(false);
                        return;
                    }

                    if (!confirm(`Weet je zeker dat je deze coach wilt verwijderen?`)) {
                        setIsLoading(false);
                        return;
                    }
                    await deleteDoc(doc(db, "coaches", coachId));
                    onUpdate();
                } catch (e) {
                     console.error("Fout bij verwijderen coach:", e);
                    alert("Kon de coach niet verwijderen.");
                } finally {
                    setIsLoading(false);
                }
            };

            const handleInputChange = (e) => setEditedData({ ...editedData, [e.target.name]: e.target.value });
            const handleNewCoachChange = (e) => setNewCoach({ ...newCoach, [e.target.name]: e.target.value });
            const handleFilterChange = (e) => setFilters({ ...filters, [e.target.name]: e.target.value });

            return (
                <div className="bg-white p-6 rounded-lg shadow space-y-6">
                    <h2 className="text-xl font-bold">Coaches ({filteredCoaches.length} / {coaches.length})</h2>
                    
                    <form onSubmit={handleAddCoach} className="p-4 border rounded-lg bg-gray-50 space-y-3">
                        <h3 className="font-semibold text-lg">Nieuwe Coach Toevoegen</h3>
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <input type="text" name="naam" value={newCoach.naam} onChange={handleNewCoachChange} placeholder="Naam" className="p-2 border rounded" required />
                            <input type="text" name="nationaliteit" value={newCoach.nationaliteit} onChange={handleNewCoachChange} placeholder="Nationaliteit" className="p-2 border rounded" />
                            <input type="text" name="nat_code" value={newCoach.nat_code} onChange={handleNewCoachChange} placeholder="Landcode (bv. NED)" className="p-2 border rounded" />
                            <input type="text" name="foto_url" value={newCoach.foto_url} onChange={handleNewCoachChange} placeholder="Foto URL" className="p-2 border rounded" />
                        </div>
                        <button type="submit" disabled={isLoading} className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-gray-400 flex items-center gap-2">
                            <AddIcon /> {isLoading ? 'Bezig...' : 'Toevoegen'}
                        </button>
                    </form>

                    <div className="p-4 border rounded-lg bg-gray-50 space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" name="zoekterm" value={filters.zoekterm} onChange={handleFilterChange} placeholder="Zoek op coachnaam..." className="p-2 border rounded" />
                            <select name="nationaliteit" value={filters.nationaliteit} onChange={handleFilterChange} className="p-2 border rounded">
                                <option value="">Alle Nationaliteiten</option>
                                {uniqueNationalities.map(n => <option key={n} value={n}>{n}</option>)}
                            </select>
                        </div>
                        <div>
                            <button onClick={handleFindMissingImages} disabled={isEnriching} className="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-400 flex items-center gap-2">
                                <ImageIcon /> {isEnriching ? 'Bezig met zoeken...' : 'Zoek ontbrekende afbeeldingen'}
                            </button>
                            {enrichStatus && <p className="text-sm text-gray-600 mt-2">{enrichStatus}</p>}
                        </div>
                    </div>

                    <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foto</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Naam</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nationaliteit</th>
                                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acties</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {filteredCoaches.map(coach => (
                                    editingRowId === coach.id ? (
                                    <tr key={coach.id}>
                                        <td className="px-6 py-4"><input type="text" name="foto_url" value={editedData.foto_url} onChange={handleInputChange} className="p-1 border rounded w-full" /></td>
                                        <td className="px-6 py-4"><input type="text" name="naam" value={editedData.naam} onChange={handleInputChange} className="p-1 border rounded w-full" /></td>
                                        <td className="px-6 py-4">
                                            <input type="text" name="nationaliteit" value={editedData.nationaliteit} onChange={handleInputChange} className="p-1 border rounded w-full mb-1" placeholder="Nationaliteit"/>
                                            <input type="text" name="nat_code" value={editedData.nat_code} onChange={handleInputChange} className="p-1 border rounded w-full" placeholder="Landcode"/>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button onClick={() => handleSaveClick(coach.id)} disabled={isLoading} className="text-green-600 hover:text-green-900"><SaveIcon /></button>
                                            <button onClick={handleCancelClick} className="text-gray-600 hover:text-gray-900 ml-2"><CancelIcon /></button>
                                        </td>
                                    </tr>
                                    ) : (
                                    <tr key={coach.id}>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            {coach.foto_url ? <img src={coach.foto_url} alt={coach.naam} className="h-10 w-10 rounded-full object-cover" onError={(e) => e.target.style.display='none'} /> : <AvatarIcon />}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap font-medium">{coach.naam}</td>
                                        <td className="px-6 py-4 whitespace-nowrap">{coach.nationaliteit} {coach.nat_code && `(${coach.nat_code})`}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button onClick={() => handleEditClick(coach)} className="text-indigo-600 hover:text-indigo-900"><EditIcon /></button>
                                            <button onClick={() => handleDelete(coach.id)} disabled={isLoading} className="text-red-600 hover:text-red-900 ml-2"><DeleteIcon /></button>
                                        </td>
                                    </tr>
                                    )
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        function SeasonsView({ initialSeasons, coaches, clubs, onUpdate, filters, setFilters }) {
            const [seasons, setSeasons] = useState(initialSeasons);
            const [editingRowId, setEditingRowId] = useState(null);
            const [editedData, setEditedData] = useState({});
            const [newSeason, setNewSeason] = useState({ seizoen: '', club: '', coachId: '', landstitel: '', nationale_beker: '', europese_prijs: '' });
            const [isLoading, setIsLoading] = useState(false);
            
            const coachesMap = useMemo(() => new Map(coaches.map(c => [c.id, c])), [coaches]);
            const clubsMap = useMemo(() => new Map(clubs.map(c => [c.id, c])), [clubs]);

            useEffect(() => { setSeasons(initialSeasons); }, [initialSeasons]);

            const filteredSeasons = useMemo(() => {
                return seasons.filter(s => {
                    const club = clubsMap.get(s.club);
                    if (filters.land && club?.land !== filters.land) return false;
                    if (filters.club && s.club !== filters.club) return false;
                    return true;
                });
            }, [seasons, filters, clubsMap]);
            
            const uniqueLands = useMemo(() => [...new Set(clubs.map(c => c.land))].sort(), [clubs]);

            const handleEditClick = (season) => {
                setEditingRowId(season.id);
                setEditedData({ ...season });
            };

            const handleCancelClick = () => {
                setEditingRowId(null);
                setEditedData({});
            };

            const handleSaveClick = async (seasonId) => {
                setIsLoading(true);
                try {
                    const { id, ...dataToSave } = editedData;
                    await updateDoc(doc(db, "seizoenen", seasonId), dataToSave);
                    setEditingRowId(null);
                    onUpdate();
                } catch (e) {
                    console.error("Fout bij opslaan seizoen:", e);
                    alert("Kon het seizoen niet opslaan.");
                } finally {
                    setIsLoading(false);
                }
            };
            
            const handleAddSeason = async (e) => {
                e.preventDefault();
                if(!newSeason.seizoen || !newSeason.club || !newSeason.coachId) {
                    alert("Seizoen, club en coach zijn verplicht.");
                    return;
                }
                setIsLoading(true);
                try {
                    const clubRef = doc(db, "clubs", newSeason.club);
                    const clubSnap = await getDoc(clubRef);
                    const clubData = clubSnap.data();

                    await addDoc(collection(db, "seizoenen"), {
                        ...newSeason,
                        land: clubData.land,
                    });
                    setNewSeason({ seizoen: '', club: '', coachId: '', landstitel: '', nationale_beker: '', europese_prijs: '' });
                    onUpdate();
                } catch (e) {
                    console.error("Fout bij toevoegen seizoen:", e);
                    alert("Kon het seizoen niet toevoegen.");
                } finally {
                    setIsLoading(false);
                }
            };

            const handleDelete = async (seasonId) => {
                if (!confirm(`Weet je zeker dat je dit seizoen wilt verwijderen?`)) return;
                setIsLoading(true);
                try {
                    await deleteDoc(doc(db, "seizoenen", seasonId));
                    onUpdate();
                } catch (e) {
                     console.error("Fout bij verwijderen seizoen:", e);
                    alert("Kon het seizoen niet verwijderen.");
                } finally {
                    setIsLoading(false);
                }
            };

            const handleInputChange = (e) => setEditedData({ ...editedData, [e.target.name]: e.target.value });
            const handleNewSeasonChange = (e) => setNewSeason({ ...newSeason, [e.target.name]: e.target.value });

            return (
                 <div className="bg-white p-6 rounded-lg shadow space-y-6">
                    <h2 className="text-xl font-bold">Seizoenen ({filteredSeasons.length} / {seasons.length})</h2>
                    
                    <form onSubmit={handleAddSeason} className="p-4 border rounded-lg bg-gray-50 space-y-3">
                        <h3 className="font-semibold text-lg">Nieuw Seizoen Toevoegen</h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" name="seizoen" value={newSeason.seizoen} onChange={handleNewSeasonChange} placeholder="Seizoen (bv. 2023-2024)" className="p-2 border rounded" required />
                            <select name="club" value={newSeason.club} onChange={handleNewSeasonChange} className="p-2 border rounded" required>
                                <option value="">Kies een club</option>
                                {clubs.map(c => <option key={c.id} value={c.id}>{c.naam}</option>)}
                            </select>
                            <select name="coachId" value={newSeason.coachId} onChange={handleNewSeasonChange} className="p-2 border rounded" required>
                                <option value="">Kies een coach</option>
                                {coaches.map(c => <option key={c.id} value={c.id}>{c.naam}</option>)}
                            </select>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" name="landstitel" value={newSeason.landstitel} onChange={handleNewSeasonChange} placeholder="Landstitel" className="p-2 border rounded" />
                            <input type="text" name="nationale_beker" value={newSeason.nationale_beker} onChange={handleNewSeasonChange} placeholder="Nationale Beker" className="p-2 border rounded" />
                            <input type="text" name="europese_prijs" value={newSeason.europese_prijs} onChange={handleNewSeasonChange} placeholder="Europese Prijs" className="p-2 border rounded" />
                        </div>
                        <button type="submit" disabled={isLoading} className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-gray-400 flex items-center gap-2">
                            <AddIcon /> {isLoading ? 'Bezig...' : 'Toevoegen'}
                        </button>
                    </form>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <select value={filters.land} onChange={e => setFilters({...filters, land: e.target.value, club: ''})} className="p-2 border rounded">
                            <option value="">Alle Landen</option>
                            {uniqueLands.map(l => <option key={l} value={l}>{l}</option>)}
                        </select>
                         <select value={filters.club} onChange={e => setFilters({...filters, club: e.target.value})} className="p-2 border rounded" disabled={!filters.land}>
                            <option value="">Alle Clubs</option>
                            {clubs.filter(c => c.land === filters.land).map(c => <option key={c.id} value={c.id}>{c.naam}</option>)}
                        </select>
                    </div>
                    <div className="overflow-x-auto max-h-[60vh]">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50 sticky top-0">
                                <tr>
                                    <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Club</th>
                                    <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Seizoen</th>
                                    <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Coach</th>
                                    <th className="px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase" title="Landstitel">T</th>
                                    <th className="px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase" title="Nationale Beker">B</th>
                                    <th className="px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase" title="Europese Prijs">E</th>
                                    <th className="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Acties</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {filteredSeasons.map(season => {
                                    const club = clubsMap.get(season.club);
                                    return (
                                        editingRowId === season.id ? (
                                        <tr key={season.id}>
                                            <td className="px-4 py-2 whitespace-nowrap font-semibold">{club?.naam || 'Onbekend'}</td>
                                            <td className="px-4 py-2"><input type="text" name="seizoen" value={editedData.seizoen} onChange={handleInputChange} className="p-1 border rounded w-full" /></td>
                                            <td className="px-4 py-2">
                                                <select name="coachId" value={editedData.coachId} onChange={handleInputChange} className="p-1 border rounded w-full">
                                                    {coaches.map(c => <option key={c.id} value={c.id}>{c.naam}</option>)}
                                                </select>
                                            </td>
                                            <td className="px-2 py-2 text-center"><input type="text" name="landstitel" value={editedData.landstitel} onChange={handleInputChange} className="p-1 border rounded w-full text-center" /></td>
                                            <td className="px-2 py-2 text-center"><input type="text" name="nationale_beker" value={editedData.nationale_beker} onChange={handleInputChange} className="p-1 border rounded w-full text-center" /></td>
                                            <td className="px-2 py-2 text-center"><input type="text" name="europese_prijs" value={editedData.europese_prijs} onChange={handleInputChange} className="p-1 border rounded w-full text-center" /></td>
                                            <td className="px-4 py-2 whitespace-nowrap text-right text-sm font-medium">
                                                <button onClick={() => handleSaveClick(season.id)} disabled={isLoading} className="text-green-600 hover:text-green-900"><SaveIcon /></button>
                                                <button onClick={handleCancelClick} className="text-gray-600 hover:text-gray-900 ml-2"><CancelIcon /></button>
                                            </td>
                                        </tr>
                                        ) : (
                                        <tr key={season.id}>
                                            <td className="px-4 py-2 whitespace-nowrap font-semibold">{club?.naam || 'Onbekend'}</td>
                                            <td className="px-4 py-2 whitespace-nowrap">{season.seizoen}</td>
                                            <td className="px-4 py-2 whitespace-nowrap">{coachesMap.get(season.coachId)?.naam || 'Onbekend'}</td>
                                            <td className="px-2 py-2 text-center">{season.landstitel}</td>
                                            <td className="px-2 py-2 text-center">{season.nationale_beker}</td>
                                            <td className="px-2 py-2 text-center">{season.europese_prijs}</td>
                                            <td className="px-4 py-2 whitespace-nowrap text-right text-sm font-medium">
                                                <button onClick={() => handleEditClick(season)} className="text-indigo-600 hover:text-indigo-900"><EditIcon /></button>
                                                <button onClick={() => handleDelete(season.id)} disabled={isLoading} className="text-red-600 hover:text-red-900 ml-2"><DeleteIcon /></button>
                                            </td>
                                        </tr>
                                        )
                                    )
                                })}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        function AnalysisView({ seasons, coaches, clubs }) {
            const [activeTab, setActiveTab] = useState('import-export');
            const [sortConfig, setSortConfig] = useState({ key: null, direction: 'ascending' });
            const summaryRefs = useRef({});

            const analysisData = useMemo(() => {
                if (!seasons.length || !coaches.length || !clubs.length) {
                    return { clubStability: [], longestTenures: [], countryStability: [], successfulCoaches: [], successfulClubs: [], leagueImports: [], popularNationsInLeague: {}, coachExports: [] };
                }

                const clubsMap = new Map(clubs.map(c => [c.id, c]));
                const coachesMap = new Map(coaches.map(c => [c.id, c]));
                
                const nationalityToCountryMap = {
                    'Dutch': 'Netherlands', 'Netherlands': 'Netherlands', 'German': 'Germany', 'Germany': 'Germany',
                    'English': 'England', 'England': 'England', 'Spanish': 'Spain', 'Spain': 'Spain',
                    'French': 'France', 'France': 'France', 'Italian': 'Italy', 'Italy': 'Italy',
                    'Portuguese': 'Portugal', 'Portugal': 'Portugal', 'Argentine': 'Argentina', 'Slovak': 'Slovakia',
                    'Yugoslav': 'Yugoslavia', 'Paraguayan': 'Paraguay', 'Welsh': 'Wales', 'Serbian': 'Serbia',
                    'Croatian': 'Croatia', 'Austrian': 'Austria', 'Brazilian': 'Brazil', 'Mexican': 'Mexico',
                    'Chilean': 'Chile', 'Uruguayan': 'Uruguay', 'Hungarian': 'Hungary', 'Scottish': 'Scotland',
                    'Northern Irish': 'Northern Ireland', 'Swedish': 'Sweden', 'Romanian': 'Romania', 'Belgian': 'Belgium'
                };

                const seasonsByClub = d3.group(seasons, d => d.club);
                const clubStability = Array.from(seasonsByClub.entries()).map(([clubId, clubSeasons]) => {
                    const clubInfo = clubsMap.get(clubId);
                    if (!clubInfo) return null;
                    clubSeasons.sort((a, b) => a.seizoen.localeCompare(b.seizoen));
                    let coachChanges = 0;
                    for (let i = 1; i < clubSeasons.length; i++) {
                        if (clubSeasons[i].coachId !== clubSeasons[i - 1].coachId) coachChanges++;
                    }
                    const totalTrophies = clubSeasons.reduce((acc, s) => acc + (s.landstitel === 'Y' ? 1 : 0) + (s.nationale_beker === 'Y' ? 1 : 0) + (s.europese_prijs === 'Y' ? 1 : 0), 0);
                    return { id: clubId, name: clubInfo.naam, country: clubInfo.land, seasons: clubSeasons.length, coachChanges, totalTrophies, avgTenure: clubSeasons.length / (coachChanges + 1) };
                }).filter(Boolean);
                
                const tenures = [];
                clubStability.forEach(club => {
                    const clubSeasons = seasonsByClub.get(club.id);
                    let currentTenure = [];
                    for(let i = 0; i < clubSeasons.length; i++) {
                        if (i === 0 || clubSeasons[i].coachId === clubSeasons[i-1].coachId) {
                            currentTenure.push(clubSeasons[i]);
                        } else {
                            if(currentTenure.length > 0) tenures.push({ coachId: clubSeasons[i-1].coachId, clubId: club.id, seasons: currentTenure });
                            currentTenure = [clubSeasons[i]];
                        }
                    }
                    if (currentTenure.length > 0) tenures.push({ coachId: currentTenure[0].coachId, clubId: club.id, seasons: currentTenure });
                });
                const longestTenures = tenures.map(t => ({
                    coachName: coachesMap.get(t.coachId)?.naam,
                    clubName: clubsMap.get(t.clubId)?.naam,
                    duration: t.seasons.length,
                    startYear: t.seasons[0].seizoen.split('/')[0],
                    endYear: t.seasons[t.seasons.length - 1].seizoen.split('/')[1] || t.seasons[t.seasons.length - 1].seizoen.split('/')[0],
                })).sort((a,b) => b.duration - a.duration);

                const countryStability = clubStability.length > 0 ? Array.from(d3.group(clubStability, d => d.country).entries()).map(([country, clubsInCountry]) => {
                    const totalChanges = d3.sum(clubsInCountry, c => c.coachChanges);
                    const totalSeasons = d3.sum(clubsInCountry, c => c.seasons);
                    return { country, avgTenure: totalSeasons / (totalChanges + clubsInCountry.length) };
                }) : [];

                const seasonsByCoach = d3.group(seasons, d => d.coachId);
                const successfulCoaches = Array.from(seasonsByCoach.entries()).map(([coachId, coachSeasons]) => {
                    const coachInfo = coachesMap.get(coachId);
                    if (!coachInfo) return null;
                    const totalTrophies = coachSeasons.reduce((acc, s) => acc + (s.landstitel === 'Y' ? 1 : 0) + (s.nationale_beker === 'Y' ? 1 : 0) + (s.europese_prijs === 'Y' ? 1 : 0), 0);
                    return { id: coachId, name: coachInfo.naam, nationality: coachInfo.nationaliteit, clubsManaged: new Set(coachSeasons.map(s => s.club)).size, seasons: coachSeasons.length, totalTrophies, trophiesPerSeason: totalTrophies > 0 ? totalTrophies / coachSeasons.length : 0 };
                }).filter(Boolean);

                const successfulClubs = clubStability.map(club => ({
                    ...club,
                    trophiesPerSeason: club.seasons > 0 ? club.totalTrophies / club.seasons : 0,
                }));

                const leagueImports = Array.from(d3.group(seasons, s => clubsMap.get(s.club)?.land).entries()).map(([leagueCountry, leagueSeasons]) => {
                    if (!leagueCountry) return null;
                    let domesticSeasons = 0, foreignSeasons = 0;
                    leagueSeasons.forEach(s => {
                        const coachNat = coachesMap.get(s.coachId)?.nationaliteit;
                        if (coachNat) {
                            const coachHomeCountry = nationalityToCountryMap[coachNat];
                            if (coachHomeCountry === leagueCountry) domesticSeasons++;
                            else foreignSeasons++;
                        }
                    });
                    const total = domesticSeasons + foreignSeasons;
                    return { country: leagueCountry, foreignPct: total > 0 ? (foreignSeasons / total * 100) : 0, details: `${foreignSeasons} / ${total}` };
                }).filter(Boolean);

                const popularNationsInLeague = {};
                leagueImports.forEach(l => {
                    const leagueSeasons = seasons.filter(s => clubsMap.get(s.club)?.land === l.country);
                    const foreignCoachIds = new Set(leagueSeasons
                        .map(s => coachesMap.get(s.coachId))
                        .filter(c => c && nationalityToCountryMap[c.nationaliteit] !== l.country)
                        .map(c => c.id)
                    );
                    const foreignCoachNats = Array.from(foreignCoachIds).map(id => coachesMap.get(id).nationaliteit);
                    popularNationsInLeague[l.country] = Array.from(d3.group(foreignCoachNats, d => d), ([nat, arr]) => ({nat, count: arr.length})).sort((a,b) => b.count - a.count);
                });

                const coachExports = Array.from(d3.group(successfulCoaches, c => c.nationality).entries()).map(([nationality, coachesOfNat]) => {
                    let foreignClubStints = 0;
                    const foreignStintsByCountry = new Map();
                    coachesOfNat.forEach(coach => {
                        const coachSeasons = seasonsByCoach.get(coach.id);
                        const coachHomeCountry = nationalityToCountryMap[nationality];
                        const foreignClubsManaged = new Set(coachSeasons.map(s => clubsMap.get(s.club)).filter(c => c && c.land !== coachHomeCountry));
                        foreignClubStints += foreignClubsManaged.size;
                        foreignClubsManaged.forEach(club => {
                            foreignStintsByCountry.set(club.land, (foreignStintsByCountry.get(club.land) || 0) + 1);
                        });
                    });
                    return { nationality, totalCoaches: coachesOfNat.length, foreignClubStints, popularDestinations: Array.from(foreignStintsByCountry.entries()).sort((a,b) => b[1] - a[1]) };
                }).filter(c => c.foreignClubStints > 0);

                return { clubStability, longestTenures, countryStability, successfulCoaches, successfulClubs, leagueImports, popularNationsInLeague, coachExports };
            }, [seasons, coaches, clubs]);

            const getSortedData = (data, config = sortConfig) => {
                if (!config.key) return data;
                return [...data].sort((a, b) => {
                    if (a[config.key] < b[config.key]) return config.direction === 'ascending' ? -1 : 1;
                    if (a[config.key] > b[config.key]) return config.direction === 'ascending' ? 1 : -1;
                    return 0;
                });
            };

            const requestSort = (key) => {
                let direction = 'ascending';
                if (sortConfig.key === key && sortConfig.direction === 'ascending') {
                    direction = 'descending';
                }
                setSortConfig({ key, direction });
            };
            
            const handleCopy = (tabKey) => {
                const element = summaryRefs.current[tabKey];
                if (element) {
                    element.select();
                    try {
                        document.execCommand('copy');
                    } catch (err) {
                        console.error('Failed to copy: ', err);
                    }
                }
            };
            
            const renderSortArrow = (key) => {
                if (sortConfig.key !== key) return null;
                return sortConfig.direction === 'ascending' ? ' ' : ' ';
            };

            const AnalysisTable = ({ title, headers, data, renderRow, sortable = false }) => (
                <div className="bg-white p-6 rounded-lg shadow">
                    <h3 className="text-lg font-semibold mb-4">{title}</h3>
                    <div className="overflow-x-auto max-h-96">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50 sticky top-0">
                                <tr>
                                    {headers.map((header) => (
                                        <th key={header.key} className={`px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase ${header.textAlign || ''} ${sortable ? 'cursor-pointer' : ''}`} onClick={() => sortable && requestSort(header.key)}>
                                            {header.label}
                                            {sortable && renderSortArrow(header.key)}
                                        </th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {getSortedData(data).map(renderRow)}
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            const SummaryBox = ({ tabKey, content }) => (
                 <div className="mt-6 bg-gray-50 p-4 rounded-lg border">
                    <div className="flex justify-between items-center mb-2">
                        <h4 className="font-semibold">Samenvatting voor Artikel</h4>
                        <button onClick={() => handleCopy(tabKey)} className="text-sm bg-gray-200 px-3 py-1 rounded-md hover:bg-gray-300 flex items-center gap-2">
                           <CopyIcon /> Kopiren
                        </button>
                    </div>
                    <textarea ref={el => { summaryRefs.current[tabKey] = el; }} readOnly className="w-full h-48 p-2 border rounded-md bg-white font-mono text-xs" value={content}></textarea>
                </div>
            );

            return (
                <div className="space-y-8">
                    <h1 className="text-3xl font-bold">Data Analyse</h1>
                    <div className="border-b border-gray-200">
                        <nav className="-mb-px flex space-x-8" aria-label="Tabs">
                            <button onClick={() => setActiveTab('import-export')} className={`${activeTab === 'import-export' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}>Import/Export</button>
                            <button onClick={() => setActiveTab('stability')} className={`${activeTab === 'stability' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}>Stabiel/Instabiel</button>
                            <button onClick={() => setActiveTab('success')} className={`${activeTab === 'success' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}>Succes</button>
                        </nav>
                    </div>

                    {activeTab === 'import-export' && (
                        <div className="space-y-8">
                             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <AnalysisTable
                                    title="Aandeel Buitenlandse Coaches per Competitie"
                                    headers={[ { key: 'country', label: 'Competitie' }, { key: 'foreignPct', label: '% Buitenlands', textAlign: 'text-center' }, { key: 'details', label: 'Details (Buitenlands / Totaal)', textAlign: 'text-center' } ]}
                                    data={analysisData.leagueImports}
                                    renderRow={(l) => ( <tr key={l.country}><td className="px-4 py-2 font-medium">{l.country}</td><td className="px-4 py-2 text-center font-bold">{l.foreignPct.toFixed(1)}%</td><td className="px-4 py-2 text-center text-sm">{l.details}</td></tr> )}
                                    sortable={true}
                                />
                                <AnalysisTable
                                    title="Populairste Buitenlandse Nationaliteiten per Competitie"
                                    headers={[ { key: 'country', label: 'Competitie' }, { key: 'nationalities', label: 'Top 3 Nationaliteiten (unieke coaches)' } ]}
                                    data={Object.entries(analysisData.popularNationsInLeague).map(([country, nats]) => ({ country, nationalities: nats }))}
                                    renderRow={(l) => ( <tr key={l.country}><td className="px-4 py-2 font-medium">{l.country}</td><td className="px-4 py-2 text-sm">{l.nationalities.slice(0,3).map(n => `${n.nat} (${n.count})`).join(', ')}</td></tr> )}
                                />
                             </div>
                             <AnalysisTable
                                title="Populaire Nationaliteiten (Export)"
                                headers={[ { key: 'nationality', label: 'Nationaliteit' }, { key: 'foreignClubStints', label: 'Buitenlandse Avonturen', textAlign: 'text-center' }, { key: 'popularDestinations', label: 'Populaire Bestemmingen' } ]}
                                data={analysisData.coachExports}
                                renderRow={(c) => ( <tr key={c.nationality}><td className="px-4 py-2 font-medium">{c.nationality}</td><td className="px-4 py-2 text-center font-bold">{c.foreignClubStints}</td><td className="px-4 py-2 text-sm">{c.popularDestinations.slice(0,3).map(([country, count]) => `${country} (${count})`).join(', ')}</td></tr> )}
                                sortable={true}
                            />
                            <SummaryBox tabKey="import-export" content={
`Analyse Import/Export:
De competitie met het hoogste percentage buitenlandse coaches is ${analysisData.leagueImports.sort((a,b) => b.foreignPct - a.foreignPct)[0]?.country} (${analysisData.leagueImports.sort((a,b) => b.foreignPct - a.foreignPct)[0]?.foreignPct.toFixed(1)}%).
De meest gesloten competitie is ${analysisData.leagueImports.sort((a,b) => a.foreignPct - b.foreignPct)[0]?.country} met slechts ${analysisData.leagueImports.sort((a,b) => a.foreignPct - b.foreignPct)[0]?.foreignPct.toFixed(1)}% buitenlandse coaches.

De nationaliteit met de meeste buitenlandse avonturen is ${analysisData.coachExports[0]?.nationality}, met ${analysisData.coachExports[0]?.foreignClubStints} stints verdeeld over hun coaches. Populaire bestemmingen voor hen zijn ${analysisData.coachExports[0]?.popularDestinations.slice(0,2).map(d=>d[0]).join(' en ')}.
`} />
                        </div>
                    )}

                    {activeTab === 'stability' && (
                        <div className="space-y-8">
                            <AnalysisTable
                                title="Coachwissels per Club"
                                headers={[ { key: 'name', label: 'Club' }, { key: 'coachChanges', label: 'Wissels', textAlign: 'text-center' }, { key: 'avgTenure', label: 'Gem. Termijn (seiz.)', textAlign: 'text-center' }, { key: 'totalTrophies', label: 'Prijzen', textAlign: 'text-center' } ]}
                                data={analysisData.clubStability}
                                renderRow={(club) => ( <tr key={club.id}><td className="px-4 py-2 font-medium">{club.name}</td><td className="px-4 py-2 text-center">{club.coachChanges}</td><td className="px-4 py-2 text-center">{club.avgTenure.toFixed(2)}</td><td className="px-4 py-2 text-center">{club.totalTrophies}</td></tr> )}
                                sortable={true}
                            />
                            <AnalysisTable
                                title="Langste Termijnen (Top 20)"
                                headers={[ { key: 'coachName', label: 'Coach' }, { key: 'clubName', label: 'Club' }, { key: 'duration', label: 'Duur (seiz.)', textAlign: 'text-center' } ]}
                                data={analysisData.longestTenures.slice(0,20)}
                                renderRow={(t) => ( <tr key={`${t.coachName}-${t.clubName}`}><td className="px-4 py-2 font-medium">{t.coachName}</td><td className="px-4 py-2">{t.clubName}</td><td className="px-4 py-2 text-center font-bold">{t.duration}</td></tr> )}
                            />
                            <SummaryBox tabKey="stability" content={
`Analyse Stabiliteit:
De meest stabiele club in de dataset is ${getSortedData(analysisData.clubStability, {key: 'avgTenure', direction: 'descending'})[0]?.name}, waar een coach gemiddeld ${getSortedData(analysisData.clubStability, {key: 'avgTenure', direction: 'descending'})[0]?.avgTenure.toFixed(2)} seizoenen blijft. Dit leverde hen ${getSortedData(analysisData.clubStability, {key: 'avgTenure', direction: 'descending'})[0]?.totalTrophies} prijzen op.
De meest instabiele club (het 'trainerskerkhof') is ${getSortedData(analysisData.clubStability, {key: 'avgTenure', direction: 'ascending'})[0]?.name} met een gemiddelde termijn van slechts ${getSortedData(analysisData.clubStability, {key: 'avgTenure', direction: 'ascending'})[0]?.avgTenure.toFixed(2)} seizoenen per coach.

De langste termijn staat op naam van ${analysisData.longestTenures[0]?.coachName} bij ${analysisData.longestTenures[0]?.clubName}, die maar liefst ${analysisData.longestTenures[0]?.duration} seizoenen aan het roer stond.
`} />
                        </div>
                    )}
                    
                    {activeTab === 'success' && (
                         <div className="space-y-8">
                            <AnalysisTable
                                title="Succesvolle Coaches"
                                headers={[ { key: 'name', label: 'Coach' }, { key: 'clubsManaged', label: 'Clubs', textAlign: 'text-center' }, { key: 'trophiesPerSeason', label: 'Prijzen/Seizoen', textAlign: 'text-center' }, { key: 'totalTrophies', label: 'Totaal Prijzen', textAlign: 'text-center' } ]}
                                data={analysisData.successfulCoaches}
                                renderRow={(coach) => ( <tr key={coach.id}><td className="px-4 py-2 font-medium">{coach.name} <span className="text-gray-500">({coach.nationality})</span></td><td className="px-4 py-2 text-center">{coach.clubsManaged}</td><td className="px-4 py-2 text-center font-semibold">{coach.trophiesPerSeason.toFixed(2)}</td><td className="px-4 py-2 text-center font-bold">{coach.totalTrophies}</td></tr> )}
                                sortable={true}
                            />
                            <AnalysisTable
                                title="Succesvolle Clubs"
                                headers={[ { key: 'name', label: 'Club' }, { key: 'totalTrophies', label: 'Totaal Prijzen', textAlign: 'text-center' }, { key: 'trophiesPerSeason', label: 'Prijzen/Seizoen', textAlign: 'text-center' }, { key: 'avgTenure', label: 'Gem. Coach Termijn', textAlign: 'text-center' } ]}
                                data={analysisData.successfulClubs}
                                renderRow={(club) => ( <tr key={club.id}><td className="px-4 py-2 font-medium">{club.name}</td><td className="px-4 py-2 text-center font-bold">{club.totalTrophies}</td><td className="px-4 py-2 text-center font-semibold">{club.trophiesPerSeason.toFixed(2)}</td><td className="px-4 py-2 text-center">{club.avgTenure.toFixed(2)}</td></tr> )}
                                sortable={true}
                            />
                            <SummaryBox tabKey="success" content={
`Analyse Succes:
De meest succesvolle coach qua totaal aantal prijzen is ${analysisData.successfulCoaches[0]?.name} met ${analysisData.successfulCoaches[0]?.totalTrophies} prijzen.
Gekeken naar efficintie (prijzen per seizoen) is ${getSortedData(analysisData.successfulCoaches, {key: 'trophiesPerSeason', direction: 'descending'})[0]?.name} de koploper met een gemiddelde van ${getSortedData(analysisData.successfulCoaches, {key: 'trophiesPerSeason', direction: 'descending'})[0]?.trophiesPerSeason.toFixed(2)} prijzen per seizoen.

De meest succesvolle club is ${getSortedData(analysisData.successfulClubs, {key: 'totalTrophies', direction: 'descending'})[0]?.name} met ${getSortedData(analysisData.successfulClubs, {key: 'totalTrophies', direction: 'descending'})[0]?.totalTrophies} prijzen.
`} />
                         </div>
                    )}
                </div>
            );
        }

        function DataCleanupView({ onUpdate }) {
            const [isLoadingOrphans, setIsLoadingOrphans] = useState(false);
            const [orphanLog, setOrphanLog] = useState([]);
            const addOrphanLog = (message) => setOrphanLog(prev => [...prev, message]);
            
            const [isLoadingNats, setIsLoadingNats] = useState(false);
            const [natLog, setNatLog] = useState([]);
            const addNatLog = (message) => setNatLog(prev => [...prev, message]);

            const handleOrphanCleanup = async () => {
                setIsLoadingOrphans(true);
                setOrphanLog([]);
                addOrphanLog("Start opschonen van wees-seizoenen...");
                try {
                    const [seasonsSnap, clubsSnap, coachesSnap] = await Promise.all([
                        getDocs(collection(db, "seizoenen")),
                        getDocs(collection(db, "clubs")),
                        getDocs(collection(db, "coaches"))
                    ]);
                    const existingClubIds = new Set(clubsSnap.docs.map(d => d.id));
                    const existingCoachIds = new Set(coachesSnap.docs.map(d => d.id));
                    const batch = writeBatch(db);
                    let deletedCount = 0;
                    seasonsSnap.forEach(doc => {
                        const season = doc.data();
                        if (!existingClubIds.has(season.club) || !existingCoachIds.has(season.coachId)) {
                            batch.delete(doc.ref);
                            deletedCount++;
                            addOrphanLog(`Seizoen ${doc.id} (${season.seizoen}) wordt verwijderd (ongeldige club/coach ID).`);
                        }
                    });
                    if (deletedCount > 0) {
                        await batch.commit();
                        addOrphanLog(`Opschonen voltooid. ${deletedCount} wees-seizoenen verwijderd.`);
                        onUpdate();
                    } else {
                        addOrphanLog("Geen wees-seizoenen gevonden.");
                    }
                } catch (e) {
                    addOrphanLog(`Fout: ${e.message}`);
                } finally {
                    setIsLoadingOrphans(false);
                }
            };

            const handleNationalityCleanup = async () => {
                setIsLoadingNats(true);
                setNatLog([]);
                addNatLog("Starten met corrigeren van nationaliteiten...");

                const corrections = {
                    "Engeland": "English", "Noord-Ierland": "Northern Irish", "Schotland": "Scottish",
                    "Frankrijk": "French", "Spanje": "Spanish", "Brazili": "Brazilian",
                    "Nederland": "Dutch", "Itali": "Italian", "Duitsland": "German",
                    "Wales": "Welsh", "Zweden": "Swedish", "Chili": "Chilean",
                    "Noorwegen": "Norwegian", "Argentini": "Argentine", "Portugal": "Portuguese",
                    "Servi": "Serbian", "Ierland": "Irish", "Denemarken": "Danish",
                    "Netherlands": "Dutch", "Hungary": "Hungarian", "Croatia": "Croatian",
                    "Austria": "Austrian", "Yugoslav": "Yugoslavian", "Czech-Italian": "Italian",
                    "Brasil": "Brazilian", "Belgium": "Belgian", "Spain": "Spanish",
                    "Germany": "German", "France": "French", "Italy": "Italian",
                    "England": "English", "Brazil": "Brazilian", "Argentinia": "Argentine",
                    "Bosnia": "Bosnian", "Scotland": "Scottish", "Denmark": "Danish",
                    "Czech": "Czech", "Yugoslavian": "Yugoslav", "Swiss": "Swiss",
                    "Romanian": "Romanian", "Polish": "Polish", "Bosnian": "Bosnian",
                    "Slovak": "Slovak", "Mexican": "Mexican", "Uruguayan": "Uruguayan",
                    "Monegasque": "Monegasque", "Angolan": "Angolan", "Bolivian": "Bolivian",
                    "Montenegrin": "Montenegrin", "American": "American", "Turkish": "Turkish",
                    "Isral": "Israeli"
                };

                try {
                    const coachesSnap = await getDocs(collection(db, "coaches"));
                    const batch = writeBatch(db);
                    let correctedCount = 0;

                    coachesSnap.forEach(coachDoc => {
                        const coach = coachDoc.data();
                        const originalNat = coach.nationaliteit;
                        if (originalNat && corrections[originalNat]) {
                            const correctedNat = corrections[originalNat];
                            if (coach.nationaliteit !== correctedNat) {
                                batch.update(coachDoc.ref, { nationaliteit: correctedNat });
                                addNatLog(`[${coach.naam}]: "${originalNat}" -> "${correctedNat}"`);
                                correctedCount++;
                            }
                        }
                    });

                    if (correctedCount > 0) {
                        await batch.commit();
                        addNatLog(`Opschonen voltooid. ${correctedCount} nationaliteiten gecorrigeerd. Data wordt herladen.`);
                        onUpdate();
                    } else {
                        addNatLog("Geen nationaliteiten gevonden die correctie vereisen op basis van de lijst.");
                    }
                } catch(e) {
                    addNatLog(`Fout: ${e.message}`);
                } finally {
                    setIsLoadingNats(false);
                }
            };

            return (
                 <div className="bg-white p-6 rounded-lg shadow space-y-6">
                    <h2 className="text-xl font-bold">Data Opschonen</h2>
                    <p className="text-gray-600">Voer onderhoudstaken uit op de database.</p>
                    
                    <div className="p-4 border rounded-lg">
                        <h3 className="font-semibold text-lg mb-2">Wees-seizoenen</h3>
                        <button onClick={handleOrphanCleanup} disabled={isLoadingOrphans} className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-400">
                            {isLoadingOrphans ? 'Bezig...' : 'Verwijder Wees-Seizoenen'}
                        </button>
                        <p className="text-sm text-gray-500 mt-2">Verwijdert seizoenen die gekoppeld zijn aan niet-bestaande clubs of coaches.</p>
                        {orphanLog.length > 0 && (
                            <div className="mt-4 p-4 bg-gray-100 rounded-md max-h-60 overflow-y-auto">
                                <h4 className="font-semibold mb-2">Log:</h4>
                                <pre className="text-xs whitespace-pre-wrap">{orphanLog.join('\n')}</pre>
                            </div>
                        )}
                    </div>

                    <div className="p-4 border rounded-lg">
                        <h3 className="font-semibold text-lg mb-2">Nationaliteiten</h3>
                        <button onClick={handleNationalityCleanup} disabled={isLoadingNats} className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400">
                            {isLoadingNats ? 'Bezig...' : 'Corrigeer Nationaliteiten'}
                        </button>
                        <p className="text-sm text-gray-500 mt-2">Corrigeert veelvoorkomende fouten in nationaliteiten (bv. 'Nederland' naar 'Dutch').</p>
                         {natLog.length > 0 && (
                            <div className="mt-4 p-4 bg-gray-100 rounded-md max-h-60 overflow-y-auto">
                                <h4 className="font-semibold mb-2">Log:</h4>
                                <pre className="text-xs whitespace-pre-wrap">{natLog.join('\n')}</pre>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function ImporterView({ onUpdateAll }) {
            const [step, setStep] = useState(1);
            const [status, setStatus] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');
            const [fileName, setFileName] = useState('');
            const [processedData, setProcessedData] = useState([]);
            const [clubLogos, setClubLogos] = useState({});

            const resetWizard = () => {
                setStep(1);
                setStatus('');
                setIsLoading(false);
                setError('');
                setFileName('');
                setProcessedData([]);
                setClubLogos({});
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setFileName(file.name);
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const parsedData = JSON.parse(event.target.result);
                        if (!Array.isArray(parsedData)) throw new Error("JSON is geen array.");
                        const dataWithIds = parsedData.map((row, index) => ({ ...row, _id: index, foto_url: '' }));
                        setProcessedData(dataWithIds);
                        setStep(2);
                    } catch (err) {
                        setError(`Fout bij lezen van JSON: ${err.message}`);
                    }
                };
                reader.readAsText(file);
            };

            const handleEnrichCoaches = async () => {
                const uniqueCoaches = [...new Set(processedData.map(s => s.coach))].filter(Boolean);
                setIsLoading(true);
                setError('');
                setStatus(`Afbeeldingen zoeken voor ${uniqueCoaches.length} coaches...`);
                try {
                    const result = await functions.enrichCoachData({ coaches: uniqueCoaches });
                    const enrichedPhotos = new Map(result.data.coaches.map(c => [c.naam, c.foto_url]));
                    const enrichedData = processedData.map(season => ({ ...season, foto_url: enrichedPhotos.get(season.coach) || season.foto_url || '' }));
                    setProcessedData(enrichedData);
                    setStatus('Afbeeldingen verrijkt.');
                } catch (e) {
                    setError(e.message);
                    setStatus('Fout bij zoeken naar afbeeldingen.');
                } finally {
                    setIsLoading(false);
                }
            };
            
            const handleImportData = async () => {
                setIsLoading(true);
                setError('');
                setStatus('Data importeren naar database...');
                try {
                    const [clubsSnapshot, coachesSnapshot] = await Promise.all([
                        getDocs(collection(db, "clubs")),
                        getDocs(collection(db, "coaches"))
                    ]);
                    const existingClubsMap = new Map(clubsSnapshot.docs.map(d => [d.data().naam, d.id]));
                    const existingCoachesMap = new Map(coachesSnapshot.docs.map(d => [d.data().naam, d.id]));
                    const batch = writeBatch(db);
                    const newClubNames = [...new Set(processedData.map(s => s.club))].filter(name => !existingClubsMap.has(name));
                    const newCoachData = new Map();
                    processedData.forEach(s => {
                        if (s.coach && !existingCoachesMap.has(s.coach) && !newCoachData.has(s.coach)) {
                            newCoachData.set(s.coach, {
                                naam: s.coach,
                                nationaliteit: s.nationaliteit || '',
                                nat_code: s.nat_code || '',
                                foto_url: s.foto_url || ''
                            });
                        }
                    });
                    const clubIdMap = new Map(existingClubsMap);
                    newClubNames.forEach(name => {
                        const newClubRef = doc(collection(db, "clubs"));
                        const clubData = processedData.find(s => s.club === name);
                        batch.set(newClubRef, {
                            naam: name,
                            land: clubData.land,
                            logo_url: clubLogos[name] || ''
                        });
                        clubIdMap.set(name, newClubRef.id);
                    });
                    const coachIdMap = new Map(existingCoachesMap);
                    for (const [name, data] of newCoachData.entries()) {
                        const newCoachRef = doc(collection(db, 'coaches'));
                        batch.set(newCoachRef, data);
                        coachIdMap.set(name, newCoachRef.id);
                    }
                    processedData.forEach(season => {
                        const coachId = coachIdMap.get(season.coach);
                        const clubId = clubIdMap.get(season.club);
                        if (coachId && clubId) {
                            const newSeasonRef = doc(collection(db, 'seizoenen'));
                            batch.set(newSeasonRef, {
                                seizoen: season.seizoen,
                                coachId: coachId,
                                club: clubId,
                                land: season.land,
                                landstitel: season.landstitel,
                                nationale_beker: season.nationale_beker,
                                europese_prijs: season.europese_prijs,
                            });
                        }
                    });
                    await batch.commit();
                    alert('Import succesvol! Alle data wordt herladen.');
                    onUpdateAll();
                    resetWizard();
                } catch (e) {
                    setError("Fout bij importeren: " + e.message);
                } finally {
                    setIsLoading(false);
                    setStatus('');
                }
            };

            const uniqueClubs = useMemo(() => [...new Set(processedData.map(d => d.club))], [processedData]);
            const uniqueCoaches = useMemo(() => {
                const coaches = new Map();
                processedData.forEach(s => {
                    if (s.coach && !coaches.has(s.coach)) {
                        coaches.set(s.coach, {
                            naam: s.coach,
                            nationaliteit: s.nationaliteit,
                            nat_code: s.nat_code,
                            foto_url: s.foto_url || ''
                        });
                    } else if (s.coach && s.foto_url && !coaches.get(s.coach).foto_url) {
                        coaches.get(s.coach).foto_url = s.foto_url;
                    }
                });
                return Array.from(coaches.values());
            }, [processedData]);

            return (
                <div>
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-2xl font-bold">Data Importer</h1>
                        {step > 1 && <button onClick={resetWizard} className="text-sm text-indigo-600 hover:underline">Opnieuw beginnen</button>}
                    </div>
                    {error && <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">{error}</div>}
                    {status && <div className="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-4" role="status">{isLoading ? <span className="animate-pulse">{status}</span> : status}</div>}
                    
                    {step === 1 && (
                        <div className="bg-white p-8 rounded-lg shadow text-center">
                            <h2 className="text-xl font-semibold mb-4">Stap 1: Upload JSON-bestand</h2>
                            <p className="text-gray-600 mb-6">Selecteer het JSON-bestand dat je met Gemini hebt gegenereerd.</p>
                            <input type="file" id="json-upload" className="hidden" accept=".json" onChange={handleFileChange} />
                            <label htmlFor="json-upload" className="cursor-pointer inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700">
                                <UploadIcon /> <span className="ml-2">Kies bestand</span>
                            </label>
                        </div>
                    )}

                    {step === 2 && (
                        <div className="bg-white p-6 rounded-lg shadow space-y-6">
                            <h2 className="text-xl font-bold">Stap 2: Verrijk Coach Afbeeldingen</h2>
                            <p className="text-gray-600">{uniqueCoaches.length} unieke coaches gevonden. Klik op de knop om afbeeldingen te zoeken.</p>
                            <div className="flex items-center gap-4">
                                <button onClick={handleEnrichCoaches} disabled={isLoading} className="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:bg-gray-400">Zoek Afbeeldingen</button>
                                <button onClick={() => setStep(3)} disabled={isLoading} className="px-4 py-2 bg-gray-200 text-gray-800 hover:bg-gray-300">Volgende Stap &raquo;</button>
                            </div>
                            <div className="max-h-96 overflow-y-auto border rounded-lg">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50 sticky top-0">
                                        <tr>
                                            <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Naam</th>
                                            <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nationaliteit</th>
                                            <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Foto</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {uniqueCoaches.map((c) => (
                                            <tr key={c.naam}>
                                                <td className="px-4 py-2 whitespace-nowrap">{c.naam}</td>
                                                <td className="px-4 py-2 whitespace-nowrap">{c.nationaliteit} ({c.nat_code})</td>
                                                <td className="px-4 py-2 whitespace-nowrap">{c.foto_url ? <img src={c.foto_url} className="h-8 w-8 object-cover rounded-full" /> : '(geen)'}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    )}

                    {step === 3 && (
                        <div className="bg-white p-6 rounded-lg shadow space-y-6">
                            <h2 className="text-xl font-bold">Stap 3: Finale Import</h2>
                            <p className="text-gray-600">Controleer de definitieve data. Voeg eventueel ontbrekende clublogo's toe en importeer alles naar de database.</p>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {uniqueClubs.map(club => (
                                    <div key={club}>
                                        <label htmlFor={`logo-${club}`} className="block text-sm font-medium text-gray-700">Logo URL voor {club}</label>
                                        <div className="flex items-center mt-1">
                                            {clubLogos[club] && <img src={clubLogos[club]} alt={`${club} logo`} className="h-8 w-8 mr-2" />}
                                            <input type="text" id={`logo-${club}`} value={clubLogos[club] || ''} onChange={(e) => setClubLogos({ ...clubLogos, [club]: e.target.value })} className="block w-full p-2 border border-gray-300 rounded-md" />
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <details>
                                <summary className="cursor-pointer text-indigo-600">Toon Volledige Seizoensdata Preview</summary>
                                <div className="max-h-96 overflow-y-auto border rounded-lg mt-4">
                                    <table className="min-w-full divide-y divide-gray-200">
                                        <thead className="bg-gray-50 sticky top-0">
                                            <tr>
                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Club</th>
                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Seizoen</th>
                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Coach</th>
                                                <th className="px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase" title="Titel">T</th>
                                                <th className="px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase" title="Beker">B</th>
                                                <th className="px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase" title="Europees">E</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white divide-y divide-gray-200">
                                            {processedData.sort((a, b) => `${a.club}${b.seizoen}`.localeCompare(`${b.club}${a.seizoen}`)).map((s) => (
                                                <tr key={s._id}>
                                                    <td className="px-4 py-2 whitespace-nowrap">{s.club}</td>
                                                    <td className="px-4 py-2 whitespace-nowrap">{s.seizoen}</td>
                                                    <td className="px-4 py-2 whitespace-nowrap">{s.coach}</td>
                                                    <td className="px-2 py-2 text-center">{s.landstitel}</td>
                                                    <td className="px-2 py-2 text-center">{s.nationale_beker}</td>
                                                    <td className="px-2 py-2 text-center">{s.europese_prijs}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </details>
                            <button onClick={handleImportData} disabled={isLoading} className="w-full px-6 py-3 bg-green-600 text-white font-bold rounded-md hover:bg-green-700 disabled:bg-gray-400">Importeer Data naar Firebase</button>
                        </div>
                    )}
                </div>
            );
        }
        
        // --- NIEUWE COMPONENTEN VOOR ARTIKELEN ---

        function ArticleEditor({ article, onSave, onCancel }) {
            const [formData, setFormData] = useState(article || { title: '', header_image_url: '', content: '', status: 'draft' });

            useEffect(() => {
                setFormData(article || { title: '', header_image_url: '', content: '', status: 'draft' });
            }, [article]);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const generateSlug = (title) => {
                return title.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]+/g, '');
            };

            const handleSave = (e) => {
                e.preventDefault();
                const slug = formData.slug || generateSlug(formData.title);
                onSave({ ...formData, slug });
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow">
                    <h2 className="text-2xl font-bold mb-6">{article ? 'Artikel Bewerken' : 'Nieuw Artikel'}</h2>
                    <form onSubmit={handleSave} className="space-y-6">
                        <div>
                            <label htmlFor="title" className="block text-sm font-medium text-gray-700">Titel</label>
                            <input type="text" name="title" id="title" value={formData.title} onChange={handleChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required />
                        </div>
                        <div>
                            <label htmlFor="slug" className="block text-sm font-medium text-gray-700">Slug (URL)</label>
                            <input type="text" name="slug" id="slug" value={formData.slug || generateSlug(formData.title)} disabled className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100" />
                        </div>
                        <div>
                            <label htmlFor="header_image_url" className="block text-sm font-medium text-gray-700">Header Afbeelding URL</label>
                            <input type="text" name="header_image_url" id="header_image_url" value={formData.header_image_url} onChange={handleChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" />
                        </div>
                        <div>
                            <label htmlFor="content" className="block text-sm font-medium text-gray-700">Inhoud (Markdown)</label>
                            <textarea name="content" id="content" value={formData.content} onChange={handleChange} rows="20" className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm"></textarea>
                        </div>
                        <div>
                            <label htmlFor="status" className="block text-sm font-medium text-gray-700">Status</label>
                            <select name="status" id="status" value={formData.status} onChange={handleChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="draft">Concept (Draft)</option>
                                <option value="published">Gepubliceerd (Published)</option>
                            </select>
                        </div>
                        <div className="flex justify-end space-x-4">
                            <button type="button" onClick={onCancel} className="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Annuleren</button>
                            <button type="submit" className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Opslaan</button>
                        </div>
                    </form>
                </div>
            );
        }

        function ArticlesView({ onUpdate }) {
            const [articles, setArticles] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [editorMode, setEditorMode] = useState(null); // null, 'new', of article.id
            const [selectedArticle, setSelectedArticle] = useState(null);
            
            const fetchArticles = useCallback(async () => {
                setIsLoading(true);
                const q = query(collection(db, "articles"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                const articlesData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setArticles(articlesData);
                setIsLoading(false);
            }, []);

            useEffect(() => {
                fetchArticles();
            }, [fetchArticles]);

            const handleSaveArticle = async (articleData) => {
                const dataToSave = { ...articleData };
                
                if (editorMode === 'new') {
                    dataToSave.createdAt = serverTimestamp();
                    if(dataToSave.status === 'published') {
                        dataToSave.publishedAt = serverTimestamp();
                    }
                    await addDoc(collection(db, "articles"), dataToSave);
                } else {
                    const articleRef = doc(db, "articles", selectedArticle.id);
                    if(dataToSave.status === 'published' && !selectedArticle.publishedAt) {
                        dataToSave.publishedAt = serverTimestamp();
                    }
                    await updateDoc(articleRef, dataToSave);
                }
                setEditorMode(null);
                setSelectedArticle(null);
                fetchArticles();
            };

            const handleDeleteArticle = async (articleId) => {
                if(confirm('Weet je zeker dat je dit artikel wilt verwijderen?')) {
                    await deleteDoc(doc(db, "articles", articleId));
                    fetchArticles();
                }
            };
            
            const handleEdit = (article) => {
                setSelectedArticle(article);
                setEditorMode(article.id);
            };

            const handleNew = () => {
                setSelectedArticle(null);
                setEditorMode('new');
            };

            const handleCancel = () => {
                setEditorMode(null);
                setSelectedArticle(null);
            };

            const handleInitialImport = async () => {
                if (!confirm("Weet je zeker dat je de 3 initile artikelen wilt importeren? Doe dit alleen als de 'articles' collectie leeg is.")) return;
                
                const initialArticles = [
                    { 
                        title: 'The Architect and The Journeyman', 
                        slug: 'architect-vs-journeyman', 
                        header_image_url: 'https://jasperkoningnl.github.io/voetbaltrainers/articles/header.png', 
                        status: 'published', 
                        content: `In the frantic, high-stakes world of modern football, the manager's seat is the hottest in the house. Its a results-driven business, a relentless merry-go-round where a handful of bad games can undo years of work. The romantic ideal of a long-serving manager, an architect patiently building a club in their own image, feels like a relic from a bygone era.\n\nOr is it?\n\nWhile the managerial carousel spins faster than ever, history shows us that the game's greatest triumphs have often been born from two vastly different philosophies. There is the **Architect**, the dynasty-builder who becomes synonymous with their club, and there is the **Journeyman**, the hired gun who conquers, leaves, and conquers again elsewhere.\n\nWhich path truly leads to glory? Using a rich dataset spanning nearly 70 years and 35 of Europe's elite clubs, we can dissect these two archetypes and explore whether stability or surgical strikes yield the ultimate prize.\n\n### The Architects: Forging an Empire\n\nWhen you think of a dynasty, you think of **Sir Alex Ferguson**. His 26-year reign at Manchester United is the definitive blueprint for long-term success. It's a tenure that seems almost impossible today. After a difficult start, a famous fan banner on a cold December day in 1989 read, **"3 years of excuses and we're still crap. Ta-ra Fergie."** The boards decision to stick by their man would become the single most important in the club's modern history.\n\nFerguson's genius wasn't just winning; it was *rebuilding*. The data clearly shows his ability to construct multiple great sides, winning the league with the swashbuckling team of the mid-90s built around the "Class of '92," and doing it all over again a decade later with the ruthless European force led by Cristiano Ronaldo and Wayne Rooney. His relentless drive was underpinned by his infamous "hairdryer treatment"a face-to-face tirade so intense that, as his players said, it would physically blow their hair back. It was this relentless demand for excellence that underpinned his dynasty. The result: 13 league titles, 5 FA Cups, and 2 Champions League trophies.\n\nAcross the continent, another architect was laying the foundations for a different kind of dynasty. **Johan Cruyff**s time at FC Barcelona (1988-1996) was shorter, but his impact was arguably just as profound. He delivered the club's first-ever European Cup in 1992 and strung together four consecutive La Liga titles. More than the silverware, Cruyff gifted Barcelona an identity. He implemented a footballing philosophya legacy carried on by his own players, most notably Pep Guardiolathat was so total and so revolutionary, it became the club's very DNA. His self-belief was legendary, captured in one of his most famous quotes:\n\n> "If I wanted you to understand it, I would have explained it better."\n\n### The Journeymen: Have Trophies, Will Travel\n\nIn stark contrast to the builders are the specialistselite coaches who move from city to city, collecting silverware like souvenirs.\n\n**Jos Mourinho** is the prototype. His career is a grand tour of Europe's footballing capitals, defined by an "us against the world" mentality. Nothing illustrates this better than a story from his time at Chelsea in 2005. After being banned from the touchline for a Champions League quarter-final, he reportedly arrived at Stamford Bridge early, hid in the dressing room, and was then wheeled out of the stadium hidden in a laundry basket to avoid being seen. It's a tale that perfectly captures his siege mentality. It worked. Our data tracks his path: an improbable Champions League with FC Porto, domestic dominance with Chelsea, a historic treble with Internazionale, and a La Liga title with Real Madrid. His stays are often short and combustible. After winning the treble with Inter in 2010, president Massimo Moratti confessed to feeling "a bit abandoned" by his immediate departure.\n\nIf Mourinho is fire, then **Carlo Ancelotti** is ice. The calm, paternal Italian has a CV that is, frankly, absurd in its breadth. Our data confirms his status as a serial winner, lifting league titles or European Cups with AC Milan, Chelsea, Real Madrid, Paris Saint-Germain, and Bayern Munich. Like Mourinho, he has answered the call to return to former clubs, managing both Chelsea and Real Madrid in two separate spells. Yet where Mourinhos returns can be fraught, Ancelottis calm authority brought even more success to Madrid, including two more Champions League trophies, cementing his status as perhaps the greatest "hired gun" of all.\n\n### The Grey Area: When Brilliance Burns Bright, and Fast\n\nNot every great manager fits neatly into these two boxes. Some, like the mercurial **Brian Clough**, were architects who were forced to be journeymen. Though not in our core dataset of 35 clubs, his story is essential. He took two unfashionable, provincial clubs, Derby County and Nottingham Forest, and led them to the English league title. With Forest, he achieved the unthinkable by winning back-to-back European Cups. Yet, his confrontational style meant he could never land a top job. His infamous spell at Leeds United in 1974 lasted just 44 days. In his very first address to the reigning champions, he reportedly told them that as far as he was concerned, they could throw all their medals in the bin because they had won them by cheating. He was a dynasty-builder at heart, but his personality made him too volatile for most boardrooms.\n\n### Conclusion: Two Paths to the Top\n\nThe data confirms there is no single blueprint for success. The romantic ideal of the Architect, like Ferguson, is rare and requires an almost unconditional trust between club and coach. It forges a legacy that transcends trophies.\n\nOpposite that is the pragmatic reality of the Journeyman, the specialist like Ancelotti or Mourinho, hired for a specific task: win now. It's a model perfectly suited to the fast-paced, results-oriented world of modern top-level football.\n\nUltimately, the "Managerial Merry-Go-Round" shows that both patience and opportunism can lead to the pinnacle of the sport. The choice for any club is: are we building a monument for the ages, or are we hiring the best specialist for today's job?` 
                    },
                    { 
                        title: 'The Global Tactician', 
                        slug: 'global-tactician', 
                        header_image_url: 'https://jasperkoningnl.github.io/voetbaltrainers/articles/global.png', 
                        status: 'published', 
                        content: `In football, ideas travel. A tactical innovation born in Amsterdam can find a home in Barcelona, while a pressing system perfected in Mainz can conquer Liverpool. The modern game is a melting pot of philosophies, often imported by the managers themselves. These coaches are more than just employees; they are cultural ambassadors, carrying a distinct footballing identity across borders.\n\nBut which nations are the most successful exporters of tactical DNA? And which leagues are most open to foreign influence? Our data, covering nearly 70 years across a sample of 35 major clubs (five per country) in Europe's top leagues, reveals some stark contrasts. Based on this sample, the English Premier League stands out as the ultimate melting pot, with a staggering 64% of its coaching positions held by foreigners. At the other end of the spectrum, France's Ligue 1 appears the most insular, with only 21% of its top club managers coming from abroad. It's important to note this reflects the top clubs, and the picture across the entire league might differ.\n\nLet's dive into the data to trace the influence of the Dutch, German, Italian, Spanish, Portuguese, and French coaching schools across the continent.\n\n### The Dutch School: An Orange Blueprint for Success\n\nFor decades, Dutch football has been a byword for innovation. From "Total Football" to the modern possession-based game, its influence is undeniable. The data shows this isn't just a philosophy; it's a highly successful export product. The story begins with two titans: **Rinus Michels** and his most gifted student, **Johan Cruyff**. Michels laid the groundwork at Barcelona in the 70s, but it was Cruyff who, upon his return as manager in 1988, built the "Dream Team" and cemented an ideological bond between Ajax and Barcelona that persists to this day.\n\nThis Dutch influence peaked in the late 90s and 2000s. **Louis van Gaal**, fresh from his Champions League victory with Ajax, brought his rigid, philosophical approachand a host of Dutch playersto Barcelona, where he won two league titles. A decade later, our data shows him repeating the feat in Germany with Bayern Munich, winning the double in 2010. His compatriot, **Frank Rijkaard**, offered a calmer, more player-centric version of the Dutch school and led a Ronaldinho-inspired Barcelona to a Champions League title in 2006. Even **Ruud Gullit** had a taste of success abroad, winning the FA Cup with Chelsea as a player-manager.\n\nNot all Dutch exports were an unqualified success. The data shows that **Peter Bosz**, successful in the Netherlands, had more difficult spells abroad at Borussia Dortmund and Olympique Lyonnais. **Ronald Koeman**'s time at Valencia was turbulent, despite winning the Copa del Rey. Yet, the demand for Dutch know-how persisted. **Guus Hiddink** had a brief, trophyless spell at Real Madrid but later won the FA Cup with Chelsea. Even the more pragmatic Dutch coaches like **Dick Advocaat**, **Huub Stevens**, and **Bert van Marwijk** found work across the border, while **Leo Beenhakker** managed to win the league with Real Madrid.\n\nThe newest wave continues this tradition. **Erik ten Hag**, despite constant criticism of his style, ended a five-season trophy drought at Manchester United by winning two cups in his first two years. And **Arne Slot**, who won the title in his debut season with Liverpool, proves that the allure of the Dutch tactical school remains as strong as ever.\n\n### The German Gegen-Wave: Heavy Metal Football Takes Over\n\nIf the Dutch taught Europe how to play with the ball, the Germans taught them how to win it back. While pioneers like **Udo Lattek** (Barcelona) and **Jupp Heynckes** had already found success abroadwith Heynckes famously winning the Champions League with Real Madrid in 1998the modern era is defined by the "Gegenpressing" revolution.\n\nThis wave was spearheaded by two managers forged in the same crucible: **Jrgen Klopp** and **Thomas Tuchel**. Both honed their craft at Mainz 05 before making their names at Borussia Dortmund. Klopp arrived at Liverpool in 2015 and famously described his philosophy as "heavy metal football." He promised to turn "doubters into believers," and he delivered, winning both the Champions League (2019) and Liverpool's first league title in 30 years (2020). Tuchel followed a similar path, taking his intense, tactically flexible approach to PSG and then winning a Champions League with Chelsea in 2021 just months after taking over.\n\nThe data shows a clear trend: where German coaches go, intensity and tactical discipline follow. **Ralf Rangnick**, considered the godfather of this pressing style, had a brief consultancy at Manchester United in an attempt to import the philosophy wholesale. Meanwhile, **Roger Schmidt**'s recent title success with Benfica proves the effectiveness of the German model beyond just the top-tier leagues. Even **Hansi Flick**, who led Bayern to a historic sextuple, has now exported his winning mentality to Barcelona.\n\n### The Italian Job: Pragmatism as a Passport\n\nItalian coaches have long been stereotyped as defensive masters of "Catenaccio." While there's a kernel of truth in their tactical discipline, the data reveals their greatest strength is actually a relentless, adaptable pragmatism. They don't export a single philosophy; they export winning.\n\nThe legendary **Giovanni Trapattoni** is a prime example. After dominating with Juventus, he won league titles in Germany with Bayern Munich and in Portugal with Benfica, adapting his style each time. But the ultimate chameleon is **Carlo Ancelotti**. The data shows him winning major honours in Italy (AC Milan), England (Chelsea), France (PSG), Germany (Bayern Munich), and Spain (Real Madrid)a feat no other manager has accomplished. His genius lies in his serene man-management, calmly handling dressing rooms full of superstars and finding a system that fits them, rather than forcing them into his.\n\n### The Spanish Armada & The Portuguese Wave\n\nFor decades, Spain exported world-class players, but not necessarily coaches. That changed dramatically with one man: **Pep Guardiola**. His revolutionary success at Barcelona created a global demand for Spanish coaches. Guardiola himself became a top export, dominating the Bundesliga with Bayern Munich and then creating an era of unprecedented success at Manchester City. He paved the way for others like **Luis Enrique** (PSG) and European specialist **Unai Emery** (PSG, Arsenal). Before them, **Rafael Bentez** had already shown that Spanish tactical intelligence was a valuable commodity, famously winning the Champions League with Liverpool in 2005.\n\nSimultaneously, Portugal has emerged as a modern powerhouse of coaching talent. The data is dominated by one figure: **Jos Mourinho**. His journey from Porto to Chelsea, Inter, Real Madrid, and Manchester United is a masterclass in winning through pragmatic, often confrontational, tactics. But he is not alone. A new generation, including **Andr Villas-Boas** (Chelsea, Marseille), **Paulo Fonseca** (Roma), and the highly-rated **Rben Amorim**, whose success at Sporting CP earned him the top job at Manchester United, has successfully managed top clubs across Europe.\n\n### French Exceptionalism: A Paradox of Talent\n\nThe French story is a paradox. While France produces a seemingly endless stream of world-class players who dominate leagues across the continent, the nation has been a modest exporter of top-tier coaching talent. Our data shows that top French clubs historically prefer domestic managers, making Ligue 1 the most "closed" league in our sample. This doesn't necessarily mean French coaches lack ambition to go abroad, but it does paint a picture of a more inward-looking coaching culture compared to its neighbours.\n\nHowever, the few who do venture abroad often make a significant, lasting impact, making them notable exceptions to the trend. The towering example is, of course, **Arsne Wenger**. His 22-year reign at Arsenal makes him an 'Architect' abroad, an anomaly who didn't just win trophies but reshaped the identity of a major English club. **Grard Houllier** also found great success in England, leading Liverpool to a cup treble in 2001. Interestingly, both men coached only one club abroad for an extended, loyal period.\n\nThis pattern of loyalty to a single foreign club is mirrored by **Zinedine Zidane**. He achieved immense success at Real Madrid, the same club where he shone as a player, winning multiple Champions League titles. Finally, there is **Didier Deschamps**. While he has primarily found success in France, he had a crucial one-season spell at Juventus, where he successfully guided the club back to Serie A after their demotion. These men prove that French coaching possesses immense quality, but they remain rare, high-impact exports rather than a consistent wave. They are not journeymen, but rather icons who commit fully to a specific project abroad, often one with which they have a personal connection.\n\n### Conclusion: The Shifting Tides of Tactical Influence\n\nLooking at the data over time, distinct patterns emerge. The 90s and early 2000s were marked by the widespread influence of the Dutch school. The last decade has been defined by the high-intensity German approach, the continued success of adaptable Italian pragmatists, and the rise of the Spanish possession game, with Portuguese coaches emerging as the new tactical heavyweights.\n\nWhat drives these trends? Success is cyclical. A groundbreaking victory, like Arrigo Sacchi's Milan or Cruyff's Barcelona, creates a blueprint that others rush to copy. A nation's economic strength and the global appeal of its top league also play a role, turning managers into highly sought-after global commodities. Ultimately, success abroad is not just about tactical knowledge, but about the ability to communicate a clear idea, adapt to a new culture, and, above all, win.`
                    },
                    { 
                        title: 'The GOAT Debate', 
                        slug: 'the-goat-debate', 
                        header_image_url: 'https://jasperkoningnl.github.io/voetbaltrainers/articles/mountgoat.png', 
                        status: 'published', 
                        content: `What makes a manager the greatest of all time? Is it the sheer volume of silverware, gleaming in a packed trophy cabinet? Is it the tactical revolution that changes how the game is played? Or is it the ability to conquer Europe, to win anywhere, or to build a dynasty that outlasts a generation?\n\nThe debate is endless, and every fan has their champion. But what does the data say? Using a rich dataset spanning nearly 70 years and 35 of Europe's elite clubs, we can move beyond gut feeling and analyse greatness through different lenses. We've identified key pillars of managerial excellence: **Sustained Dominance**, **European Glory**, **Global Success**, and perhaps most importantly in the modern era, **Winning Efficiency**.\n\nThis is not a definitive ranking, but an exploration of the different forms of greatness, a data-driven "Mount Rushmore" of the men who have shaped modern football.\n\n### The Kings of Longevity: Building an Empire\n\nThis is the realm of relentless, sustained dominance, where winning year after year was the standard. When we look at the pure volume of trophies won, one name stands as the benchmark for longevity: **Sir Alex Ferguson**. His haul of 25 major trophies with Manchester United is a monument to adaptation, building multiple legendary teams over 26 years. His prizes-per-season ratio of 0.93 is incredibly impressive over such a long period.\n\nAlongside him stand other titans who defined their eras at a single club. **Miguel Muoz**, the architect of the great Real Madrid side of the 50s and 60s, managed the club for 14 years, securing 12 trophies, including two European Cups. And **Arsne Wenger**, with his 22-year tenure at Arsenal, is another prime example. While his trophy count (12) and efficiency (0.41) are lower, his impact in building a club identity and overseeing a stadium move solidifies his status as a true dynasty-builder. These men represent the classic model of greatness: achieving consistent, long-term success through loyalty and evolution.\n\n### The Modern Super-Coaches: Efficiency and Global Conquest\n\nWhile the old guard built their legends over decades, the modern era has produced a new breed of super-coach, defined by intense, concentrated dominance and the ability to win anywhere.\n\nNo one embodies this more than **Pep Guardiola**. The data positions him as arguably the most complete manager of the 21st century. He matches Ferguson's staggering 25 trophies but has done so in a far shorter timeframe, resulting in a phenomenal prizes-per-season ratio of 1.56. He is not just a winner; he is a tactical revolutionary, a "Globetrotter" with league titles in Spain, Germany, and England, and a "Perfectionist" who has achieved the historic treble twice. He combines volume, efficiency, and game-changing impact in a way no other manager has.\n\nHis great rival, **Jos Mourinho**, is the ultimate pragmatic conqueror. With 20 trophies and an excellent efficiency rating of 1.18, he has proven he can win in any environment, from his underdog Champions League victory with Porto to his treble with Inter. Then there is **Carlo Ancelotti**, the specialist's specialist. While his volume and efficiency are lower in our data, his record five Champions League titles and his unique achievement of winning the league in all five major European countries make him a master of global success and European glory. This group, which also includes multi-league winners like **Louis van Gaal** (Netherlands, Spain, Germany) and **Giovanni Trapattoni** (Italy, Germany, Portugal), represents a different kind of greatness: the ability to export a winning formula.\n\n### The Revolutionaries: More Than Just Trophies\n\nFinally, there are managers whose greatness is difficult to capture in numbers alone, or who achieved such unique feats that they stand apart.\n\n**Zinedine Zidane** falls into this category. His achievement of winning three consecutive Champions League titles with Real Madrid is an anomaly in the modern game, a feat of knockout-tournament mastery that may never be repeated.\n\nAnd then there is **Johan Cruyff**. Though his trophy count is more modest than the serial winners, his influence is arguably greater than any other. He didn't just manage Barcelona; he installed a footballing philosophy, a DNA that directly led to the success of his disciples, including Guardiola and Rijkaard. His legacy is not measured in silverware, but in the very way modern football is played and understood. The German duo of **Udo Lattek** and **Ottmar Hitzfeld** can also be seen in this light; they didn't just win, they established a culture of dominance at Bayern Munich and Borussia Dortmund that defined German football for generations.\n\n### Conclusion: A New GOAT for a New Era?\n\nSo, who is the greatest? The ultimate debate may now be a Mancunian affair: Ferguson's United dynasty versus Guardiola's City machine, two different models of success that have defined their respective eras. The data doesn't give one simple answer, but it does illuminate a shift. While Ferguson set the 20th-century benchmark for sustained, single-club dominance, **Pep Guardiola** has redefined what managerial greatness looks like in the 21st century.\n\nHis unprecedented combination of winning volume, revolutionary tactics, staggering efficiency, and proven success across multiple top leagues makes him, based on the data, the most complete candidate for the modern "GOAT" title. While the romanticism of Ferguson's long reign and the European genius of Ancelotti provide compelling counterarguments, Guardiola's record represents a new, higher-velocity era of managerial dominance. The debate will rage on, but the data suggests the benchmark has been raised.`
                    }
                ];

                const batch = writeBatch(db);
                initialArticles.forEach(article => {
                    const docRef = doc(collection(db, "articles"));
                    batch.set(docRef, { ...article, createdAt: serverTimestamp(), publishedAt: serverTimestamp() });
                });
                await batch.commit();
                alert('De 3 artikelen zijn gemporteerd.');
                fetchArticles();
            };

            if (isLoading) {
                return <div>Artikelen laden...</div>;
            }

            if (editorMode) {
                return <ArticleEditor article={selectedArticle} onSave={handleSaveArticle} onCancel={handleCancel} />;
            }

            return (
                <div className="bg-white p-6 rounded-lg shadow space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-bold">Artikelen ({articles.length})</h2>
                        <div className="space-x-2">
                            <button onClick={handleInitialImport} className="px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600">Importeer 3 Bestaande Artikelen</button>
                            <button onClick={handleNew} className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Nieuw Artikel</button>
                        </div>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Titel</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aangemaakt op</th>
                                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Acties</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {articles.map(article => (
                                    <tr key={article.id}>
                                        <td className="px-6 py-4 whitespace-nowrap font-medium">{article.title}</td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${article.status === 'published' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`}>
                                                {article.status}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {article.createdAt?.toDate().toLocaleDateString('nl-NL')}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button onClick={() => handleEdit(article)} className="text-indigo-600 hover:text-indigo-900"><EditIcon /></button>
                                            <button onClick={() => handleDeleteArticle(article.id)} className="text-red-600 hover:text-red-900 ml-4"><DeleteIcon /></button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }


        // --- HOOFD APPLICATIE ---
        function App() {
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);
            const [view, setView] = useState('analysis');
            const [appData, setAppData] = useState({ clubs: [], coaches: [], seasons: [] });
            const [dataLoading, setDataLoading] = useState(true);
            const [dataError, setDataError] = useState(null);
            const [filters, setFilters] = useState({ land: '', club: '' });
            
            const fetchAllData = useCallback(async () => { 
                setDataLoading(true); 
                setDataError(null); 
                try { 
                    const [seasonsSnapshot, coachesSnapshot, clubsSnapshot] = await Promise.all([ 
                        getDocs(query(collection(db, "seizoenen"))), 
                        getDocs(query(collection(db, "coaches"), orderBy("naam"))), 
                        getDocs(query(collection(db, "clubs"), orderBy("naam"))) 
                    ]); 
                    const seasonsData = seasonsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); 
                    const coachesData = coachesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); 
                    const clubsData = clubsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); 
                    seasonsData.sort((a,b) => b.seizoen.localeCompare(a.seizoen)); 
                    setAppData({ seasons: seasonsData, coaches: coachesData, clubs: clubsData }); 
                } catch (e) { 
                    console.error("Fout bij ophalen van data:", e); 
                    setDataError("Kon de data niet laden vanuit de database."); 
                } 
                setDataLoading(false); 
            }, []);

            useEffect(() => { 
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => { 
                    setUser(currentUser); 
                    setAuthLoading(false); 
                    if (currentUser) { 
                        fetchAllData(); 
                    } 
                }); 
                return () => unsubscribe(); 
            }, [fetchAllData]);

            const handleLogin = () => { 
                const provider = new GoogleAuthProvider(); 
                signInWithPopup(auth, provider).catch((error) => console.error("Login Fout:", error)); 
            };
            
            const handleLogout = () => { 
                signOut(auth).catch(error => console.error("Logout Fout:", error)); 
            };
            
            if (authLoading) { 
                return <div className="flex items-center justify-center h-screen"><p>Dashboard laden...</p></div> 
            }
            
            if (!user) { 
                return ( 
                    <div className="flex items-center justify-center h-screen bg-gray-200"> 
                        <div className="text-center bg-white p-10 rounded-lg shadow-xl"> 
                            <h1 className="text-3xl font-bold mb-2">Data Dashboard</h1> 
                            <p className="text-gray-600 mb-6">Log in om de data te beheren.</p> 
                            <button onClick={handleLogin} className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded inline-flex items-center"> 
                                <svg className="w-6 h-6 mr-2" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg> 
                                <span>Login met Google</span> 
                            </button> 
                        </div> 
                    </div> 
                ); 
            }
            
            return (
                <div className="flex h-screen">
                    <aside className="w-64 bg-gray-800 text-white flex flex-col">
                         <div className="p-4 border-b border-gray-700"><h2 className="text-xl font-bold">Dashboard</h2><span className="text-sm text-gray-400">v24.0</span></div>
                        <nav className="flex-grow p-2">
                             <a href="#" onClick={(e) => {e.preventDefault(); setView('analysis');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'analysis' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><ChartBarIcon /> Analyse</a>
                             <a href="#" onClick={(e) => {e.preventDefault(); setView('articles');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'articles' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><ArticleIcon /> Artikelen</a>
                             <a href="#" onClick={(e) => {e.preventDefault(); setView('importer');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'importer' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><UploadIcon /> Importer</a>
                             <a href="#" onClick={(e) => {e.preventDefault(); setView('seasons');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'seasons' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><ListIcon /> Seizoenen</a>
                             <a href="#" onClick={(e) => {e.preventDefault(); setView('clubs');}} className={`flex items-center gap-3 px-3 py-2 rounded-md ${view === 'clubs' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><DatabaseIcon /> Clubs</a>
                            <a href="#" onClick={(e) => {e.preventDefault(); setView('coaches');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'coaches' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><UserIcon /> Coaches</a>
                            <a href="#" onClick={(e) => {e.preventDefault(); setView('cleanup');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'cleanup' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><ToolIcon /> Data Opschonen</a>
                        </nav>
                         <div className="p-4 border-t border-gray-700"><div className="flex items-center gap-2 mb-4"><img src={user.photoURL} alt={user.displayName} className="w-8 h-8 rounded-full" /><span className="text-sm font-medium">{user.displayName}</span></div><button onClick={handleLogout} className="w-full flex items-center justify-center gap-3 px-3 py-2 rounded-md bg-red-600 hover:bg-red-700"><LogOutIcon /> Uitloggen</button></div>
                    </aside>
                    <main className="flex-1 p-8 overflow-y-auto">
                        {dataLoading ? <div className="text-center">Database data aan het laden...</div> : 
                         dataError ? <div className="text-center text-red-500">{dataError}</div> :
                            {
                                'analysis': <AnalysisView seasons={appData.seasons} coaches={appData.coaches} clubs={appData.clubs} />,
                                'articles': <ArticlesView />,
                                'clubs': <ClubsView initialClubs={appData.clubs} onUpdate={fetchAllData} />,
                                'coaches': <CoachesView initialCoaches={appData.coaches} onUpdate={fetchAllData} />,
                                'seasons': <SeasonsView initialSeasons={appData.seasons} coaches={appData.coaches} clubs={appData.clubs} onUpdate={fetchAllData} filters={filters} setFilters={setFilters} />,
                                'cleanup': <DataCleanupView onUpdate={fetchAllData} />,
                                'importer': <ImporterView onUpdateAll={fetchAllData} />
                            }[view]
                        }
                    </main>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
