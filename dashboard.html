<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voetbaltrainers Data Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, addDoc, deleteDoc, orderBy, query, writeBatch, where, getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDZckphHLQiTK2KZHPOyPDxgB6glBr4HpY",
            authDomain: "voetbaltrainers.firebaseapp.com",
            projectId: "voetbaltrainers",
            storageBucket: "voetbaltrainers.appspot.com",
            messagingSenderId: "640532231483",
            appId: "1:640532231483:web:54d614b65b3e2c4adc731e",
            measurementId: "G-YQV6E3V2CK"
        };
        
        const app = initializeApp(firebaseConfig);
        const functions = getFunctions(app, 'europe-west1');

        window.firebaseServices = {
            auth: getAuth(app),
            db: getFirestore(app),
            functions: {
                getClubsForCountry: httpsCallable(functions, 'getClubsForCountry'),
                getClubData: httpsCallable(functions, 'getClubData'),
                enrichCoachData: httpsCallable(functions, 'enrichCoachData'),
            },
            GoogleAuthProvider,
            signInWithPopup,
            signOut,
            onAuthStateChanged,
            collection, getDocs, doc, updateDoc, addDoc, deleteDoc, orderBy, query, writeBatch, where
        };
    </script>
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;
        const { db, auth, functions, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, collection, getDocs, doc, updateDoc, addDoc, deleteDoc, orderBy, query, writeBatch, where } = window.firebaseServices;

        // --- ICONEN (onveranderd) ---
        const DatabaseIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>;
        const UserIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>;
        const SparklesIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="m12 3-1.9 5.8-5.8 1.9 5.8 1.9 1.9 5.8 1.9-5.8 5.8-1.9-5.8-1.9Z"></path></svg>;
        const LogOutIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" x2="9" y1="12" y2="12"></line></svg>;
        const EditIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path></svg>;
        const SaveIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>;
        const CancelIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const ListIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg>;
        const TrashIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const PlusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4 mr-1"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const ImageIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4 mr-2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="9" cy="9" r="2"></circle><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path></svg>;
        const AvatarIcon = () => <span className="inline-block h-10 w-10 rounded-full overflow-hidden bg-gray-100"><svg className="h-full w-full text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M24 20.993V24H0v-2.997A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" /></svg></span>;
        const ToolIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>;
        
        // --- HELPER FUNCTIE: Afbeeldingen-Zoeker ---
        async function findImageOnWikidata(coachName) {
            try {
                const wikiApiUrl = `https://en.wikipedia.org/w/api.php?action=query&prop=pageprops&ppprop=wikibase_item&format=json&origin=*&titles=${encodeURIComponent(coachName)}`;
                const wikiResponse = await fetch(wikiApiUrl);
                const wikiData = await wikiResponse.json();
                const pages = wikiData.query.pages;
                const pageId = Object.keys(pages)[0];
                if (pageId === "-1" || !pages[pageId].pageprops?.wikibase_item) return null;
                const qCode = pages[pageId].pageprops.wikibase_item;

                const wikidataApiUrl = `https://www.wikidata.org/w/api.php?action=wbgetentities&ids=${qCode}&props=claims&format=json&origin=*`;
                const wikidataResponse = await fetch(wikidataApiUrl);
                const wikidataData = await wikidataResponse.json();
                const claims = wikidataData.entities[qCode].claims;
                if (!claims.P18) return null;
                const fileName = claims.P18[0].mainsnak.datavalue.value;
                
                const commonsApiUrl = `https://commons.wikimedia.org/w/api.php?action=query&titles=File:${encodeURIComponent(fileName)}&prop=imageinfo&iiprop=url&format=json&origin=*`;
                const commonsResponse = await fetch(commonsApiUrl);
                const commonsData = await commonsResponse.json();
                const commonsPages = commonsData.query.pages;
                const commonsPageId = Object.keys(commonsPages)[0];
                const imageInfo = commonsPages[commonsPageId].imageinfo;

                if (!imageInfo || imageInfo.length === 0) return null;
                return imageInfo[0].url;
            } catch (error) {
                console.error(`Fout bij zoeken naar afbeelding voor ${coachName}:`, error);
                return null;
            }
        }

        // --- COMPONENTEN ---
        function ClubsView({ initialClubs, onUpdate }) { /* ongewijzigd */ return <div>Clubbeheer (code ongewijzigd)</div>; }
        
        function CoachesView({ initialCoaches, onUpdate }) {
            const [coaches, setCoaches] = useState([]);
            const [nameFilter, setNameFilter] = useState('');
            const [natFilter, setNatFilter] = useState('');
            const [editingId, setEditingId] = useState(null);
            const [editFormData, setEditFormData] = useState({});
            const [newCoach, setNewCoach] = useState({ naam: '', nationaliteit: '', nat_code: '', foto_url: '' });
            const [brokenImageLinks, setBrokenImageLinks] = useState(new Set());
            const [isFindingImages, setIsFindingImages] = useState(false);
            const [imageFinderStatus, setImageFinderStatus] = useState('');

            const availableNationalities = useMemo(() => [...new Set(initialCoaches.map(c => c.nationaliteit))].sort(), [initialCoaches]);

            useEffect(() => {
                const filtered = initialCoaches.filter(coach => {
                    const nameMatch = coach.naam.toLowerCase().includes(nameFilter.toLowerCase());
                    const natMatch = !natFilter || coach.nationaliteit === natFilter;
                    return nameMatch && natMatch;
                });
                setCoaches(filtered);
            }, [initialCoaches, nameFilter, natFilter]);

            // --- AFBEELDINGEN-ZOEKER LOGICA ---
            const handleFindImages = async () => {
                setIsFindingImages(true);
                setImageFinderStatus('Scannen naar coaches zonder afbeelding...');
                
                const coachesToUpdate = initialCoaches.filter(c => !c.foto_url);
                
                if (coachesToUpdate.length === 0) {
                    setImageFinderStatus('Alle coaches hebben al een afbeelding.');
                    setTimeout(() => { setIsFindingImages(false); setImageFinderStatus(''); }, 3000);
                    return;
                }
                
                let foundCount = 0;
                for (let i = 0; i < coachesToUpdate.length; i++) {
                    const coach = coachesToUpdate[i];
                    setImageFinderStatus(`Bezig met ${coach.naam} (${i + 1}/${coachesToUpdate.length})...`);
                    const imageUrl = await findImageOnWikidata(coach.naam);

                    if (imageUrl) {
                        try {
                            await updateDoc(doc(db, "coaches", coach.id), { foto_url: imageUrl });
                            foundCount++;
                        } catch (error) { console.error(`Fout bij updaten van coach ${coach.id}:`, error); }
                    }
                    await new Promise(res => setTimeout(res, 250)); // Pauze
                }

                setImageFinderStatus(`Klaar! ${foundCount} van de ${coachesToUpdate.length} afbeeldingen gevonden.`);
                onUpdate(); 
                setTimeout(() => { setIsFindingImages(false); setImageFinderStatus(''); }, 5000);
            };

            // ... overige handlers (ongewijzigd)
            const handleImageError = (coachId) => { setBrokenImageLinks(prev => new Set(prev).add(coachId)); };
            const handleEditClick = (coach) => { setEditingId(coach.id); setEditFormData(coach); };
            const handleCancelClick = () => setEditingId(null);
            const handleInputChange = (e, field) => { setEditFormData({ ...editFormData, [field]: e.target.value }); };
            const handleNewCoachChange = (e, field) => { setNewCoach({ ...newCoach, [field]: e.target.value }); };
            const handleSaveClick = async (id) => { try { await updateDoc(doc(db, 'coaches', id), editFormData); setEditingId(null); onUpdate(); } catch (error) { console.error("Error updating coach:", error); alert("Failed to update coach.");} };
            const handleAddCoach = async (e) => { e.preventDefault(); if (!newCoach.naam || !newCoach.nationaliteit || !newCoach.nat_code) { alert("Naam, nationaliteit en landcode zijn verplicht."); return; } try { await addDoc(collection(db, 'coaches'), newCoach); setNewCoach({ naam: '', nationaliteit: '', nat_code: '', foto_url: '' }); onUpdate(); } catch (error) { console.error("Error adding coach:", error); alert("Failed to add coach."); } };
            const handleDeleteClick = async (id) => { if (window.confirm("Weet je zeker dat je deze coach wilt verwijderen?")) { try { await deleteDoc(doc(db, 'coaches', id)); onUpdate(); } catch (error) { console.error("Error deleting coach:", error); alert("Failed to delete coach."); } } };

            return (
                <div>
                    <div className="flex justify-between items-center mb-4">
                        <h1 className="text-2xl font-bold">Coach Beheer</h1>
                         <div className="flex items-center space-x-3">
                             <button
                                onClick={handleFindImages}
                                disabled={isFindingImages}
                                className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed"
                            >
                                <ImageIcon />
                                {isFindingImages ? 'Bezig...' : 'Zoek Ontbrekende Afbeeldingen'}
                            </button>
                           {imageFinderStatus && <span className="text-sm text-gray-600 animate-pulse">{imageFinderStatus}</span>}
                        </div>
                    </div>
                    {/* ... rest van de JSX voor CoachesView (filters, tabel, etc.) is ongewijzigd ... */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input type="text" placeholder="Filter op naam..." value={nameFilter} onChange={(e) => setNameFilter(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md"/>
                        <select value={natFilter} onChange={(e) => setNatFilter(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md bg-white">
                            <option value="">Filter op nationaliteit...</option>
                            {availableNationalities.map(n => <option key={n} value={n}>{n}</option>)}
                        </select>
                    </div>
                    <div className="bg-white shadow rounded-lg overflow-x-auto">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foto</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Naam</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nationaliteit</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foto URL</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acties</th></tr></thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {coaches.map((coach) => (
                                    <tr key={coach.id}>
                                        {editingId === coach.id ? (
                                            <>
                                                <td className="px-6 py-4">-</td>
                                                <td className="px-6 py-4"><input type="text" value={editFormData.naam} onChange={(e) => handleInputChange(e, 'naam')} className="w-full px-2 py-1 border rounded" /></td>
                                                <td className="px-6 py-4"><input type="text" value={editFormData.nationaliteit} onChange={(e) => handleInputChange(e, 'nationaliteit')} className="w-full px-2 py-1 border rounded mb-1" placeholder="bv. Netherlands"/><input type="text" value={editFormData.nat_code} onChange={(e) => handleInputChange(e, 'nat_code')} className="w-full px-2 py-1 border rounded" placeholder="bv. nl"/></td>
                                                <td className="px-6 py-4"><input type="text" value={editFormData.foto_url} onChange={(e) => handleInputChange(e, 'foto_url')} className="w-full px-2 py-1 border rounded" /></td>
                                                <td className="px-6 py-4 text-right space-x-2 whitespace-nowrap"><button onClick={() => handleSaveClick(coach.id)} className="text-green-600 hover:text-green-900 p-1"><SaveIcon /></button><button onClick={handleCancelClick} className="text-gray-600 hover:text-gray-900 p-1"><CancelIcon /></button></td>
                                            </>
                                        ) : (
                                            <>
                                                <td className="px-6 py-4">{brokenImageLinks.has(coach.id) || !coach.foto_url ? <AvatarIcon/> : <img src={coach.foto_url} alt={coach.naam} className="h-10 w-10 rounded-full object-cover" onError={() => handleImageError(coach.id)} /> }</td>
                                                <td className="px-6 py-4 whitespace-nowrap font-medium text-gray-900">{coach.naam}</td>
                                                <td className="px-6 py-4 whitespace-nowrap"><div className="flex items-center">{coach.nat_code && <img src={`https://flagcdn.com/w20/${coach.nat_code.toLowerCase()}.png`} alt={coach.nationaliteit} className="h-4 mr-2" />} {coach.nationaliteit}</div></td>
                                                <td className="px-6 py-4 whitespace-nowrap truncate max-w-xs">{coach.foto_url}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"><button onClick={() => handleEditClick(coach)} className="text-indigo-600 hover:text-indigo-900 p-1"><EditIcon /></button><button onClick={() => handleDeleteClick(coach.id)} className="text-red-600 hover:text-red-900 p-1"><TrashIcon /></button></td>
                                            </>
                                        )}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                     <div id="add-coach-form" className="mt-8">
                        <h2 className="text-xl font-bold mb-4">Nieuwe Coach Toevoegen</h2>
                        <form onSubmit={handleAddCoach} className="bg-white shadow rounded-lg p-6 space-y-4">
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"><input type="text" placeholder="Naam" value={newCoach.naam} onChange={(e) => handleNewCoachChange(e, 'naam')} className="block w-full px-3 py-2 border border-gray-300 rounded-md" required /><input type="text" placeholder="Nationaliteit (bv. Netherlands)" value={newCoach.nationaliteit} onChange={(e) => handleNewCoachChange(e, 'nationaliteit')} className="block w-full px-3 py-2 border border-gray-300 rounded-md" required /><input type="text" placeholder="Landcode (bv. nl)" value={newCoach.nat_code} onChange={(e) => handleNewCoachChange(e, 'nat_code')} className="block w-full px-3 py-2 border border-gray-300 rounded-md" required /><input type="text" placeholder="Foto URL" value={newCoach.foto_url} onChange={(e) => handleNewCoachChange(e, 'foto_url')} className="block w-full px-3 py-2 border border-gray-300 rounded-md" /></div><div className="text-right"><button type="submit" className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700"><PlusIcon /> Coach Toevoegen</button></div>
                        </form>
                    </div>
                </div>
            );
        }
        function SeasonsView({ initialSeasons, coaches, clubs, onUpdate, filters, setFilters }) { /* ongewijzigd */ return <div>Seizoenenbeheer (code ongewijzigd)</div>; }
        function DataCleanupView({ coaches, onUpdate }) { /* ongewijzigd */ return <div>Data opschonen (code ongewijzigd)</div>; }

        // --- NIEUW: WizardView vervangt de oude AiView ---
        function WizardView({ onUpdateAll }) {
            const [step, setStep] = useState(1); // 1: land, 2: club, 3: resultaat
            const [country, setCountry] = useState('Netherlands');
            const [clubs, setClubs] = useState([]);
            const [selectedClub, setSelectedClub] = useState('');
            const [seasonsData, setSeasonsData] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');

            const handleGetClubs = async () => {
                setIsLoading(true);
                setError('');
                try {
                    const result = await functions.getClubsForCountry({ country });
                    setClubs(result.data.clubs);
                    setStep(2);
                } catch (e) { setError(e.message); } finally { setIsLoading(false); }
            };

            const handleGetSeasons = async () => {
                setIsLoading(true);
                setError('');
                try {
                    const result = await functions.getClubData({ country, club: selectedClub });
                    setSeasonsData(result.data.data);
                    setStep(3);
                } catch (e) { setError(e.message); } finally { setIsLoading(false); }
            };

            const handleImportData = async () => {
                setIsLoading(true);
                setError('');

                try {
                    // 1. Unieke coaches verzamelen
                    const coachNames = [...new Set(seasonsData.map(s => s.coach))];
                    
                    // 2. Coaches verrijken (zonder foto)
                    const enrichResult = await functions.enrichCoachData({ coaches: coachNames });
                    const enrichedCoaches = enrichResult.data.coaches;

                    // 3. Bestaande coaches ophalen
                    const existingCoachesSnapshot = await getDocs(collection(db, "coaches"));
                    const existingCoaches = existingCoachesSnapshot.docs.map(d => ({id: d.id, ...d.data()}));
                    const existingCoachesMap = new Map(existingCoaches.map(c => [c.naam, c.id]));

                    const batch = writeBatch(db);
                    const newCoachesMap = new Map();

                    // 4. Nieuwe coaches toevoegen aan batch
                    enrichedCoaches.forEach(coach => {
                        if (!existingCoachesMap.has(coach.naam)) {
                            const newCoachRef = doc(collection(db, 'coaches'));
                            batch.set(newCoachRef, coach);
                            newCoachesMap.set(coach.naam, newCoachRef.id);
                        }
                    });

                     // 5. Seizoenen toevoegen aan batch
                    seasonsData.forEach(season => {
                        const coachId = existingCoachesMap.get(season.coach) || newCoachesMap.get(season.coach);
                        if (coachId) {
                            const newSeasonRef = doc(collection(db, 'seizoenen'));
                            batch.set(newSeasonRef, {
                                seizoen: season.seizoen,
                                coachId: coachId,
                                // TODO: Club ID moet nog gekoppeld worden.
                                // Dit vereist een zoekactie op clubnaam of een selectie-uitbreiding.
                                // Voor nu laten we dit veld leeg.
                                club: '', // Placeholder
                                land: country,
                                landstitel: season.landstitel,
                                nationale_beker: season.nationale_beker,
                                europese_prijs: season.europese_prijs,
                            });
                        }
                    });
                    
                    await batch.commit();
                    alert('Import succesvol! De data wordt herladen.');
                    onUpdateAll(); // Herlaad alle data in de app
                    setStep(1); // Reset de wizard
                } catch(e) {
                     setError("Fout bij importeren: " + e.message);
                } finally {
                     setIsLoading(false);
                }
            };
            
            return (
                <div>
                    <h1 className="text-2xl font-bold mb-6">Nieuw Land Wizard</h1>
                    {error && <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">{error}</div>}

                    {step === 1 && (
                        <div className="bg-white p-6 rounded-lg shadow">
                            <label htmlFor="country" className="block text-sm font-medium text-gray-700">Stap 1: Voer een land in (Engels)</label>
                            <div className="mt-1 flex rounded-md shadow-sm">
                                <input type="text" id="country" value={country} onChange={e => setCountry(e.target.value)} className="flex-1 block w-full rounded-none rounded-l-md sm:text-sm border-gray-300 p-2"/>
                                <button onClick={handleGetClubs} disabled={isLoading} className="inline-flex items-center px-4 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-gray-700 hover:bg-gray-100 disabled:bg-gray-200">
                                    {isLoading ? 'Bezig...' : 'Zoek Clubs'}
                                </button>
                            </div>
                        </div>
                    )}

                    {step === 2 && (
                         <div className="bg-white p-6 rounded-lg shadow">
                            <label htmlFor="club" className="block text-sm font-medium text-gray-700">Stap 2: Kies een club</label>
                            <div className="mt-1 flex rounded-md shadow-sm">
                                <select id="club" value={selectedClub} onChange={e => setSelectedClub(e.target.value)} className="flex-1 block w-full rounded-none rounded-l-md sm:text-sm border-gray-300 p-2">
                                    <option value="">-- Selecteer een club --</option>
                                    {clubs.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                                <button onClick={handleGetSeasons} disabled={isLoading || !selectedClub} className="inline-flex items-center px-4 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-gray-700 hover:bg-gray-100 disabled:bg-gray-200">
                                    {isLoading ? 'Bezig...' : 'Haal Seizoensdata op'}
                                </button>
                            </div>
                         </div>
                    )}

                    {step === 3 && (
                        <div className="bg-white p-6 rounded-lg shadow">
                             <h2 className="text-xl font-bold mb-4">Stap 3: Controleer en Importeer Data</h2>
                             <p>De volgende data wordt geïmporteerd voor <strong>{selectedClub}</strong>. Coaches worden automatisch aangemaakt of gekoppeld.</p>
                             <div className="max-h-96 overflow-y-auto my-4 border rounded-lg">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500">Seizoen</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500">Coach</th></tr></thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {seasonsData.map((s, i) => <tr key={i}>
                                            <td className="px-6 py-4 whitespace-nowrap">{s.seizoen}</td>
                                            <td className="px-6 py-4 whitespace-nowrap">{s.coach}</td>
                                        </tr>)}
                                    </tbody>
                                </table>
                             </div>
                             <div className="text-right">
                                <button onClick={handleImportData} disabled={isLoading} className="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400">
                                    {isLoading ? 'Bezig met importeren...' : `Importeer ${seasonsData.length} seizoenen`}
                                 </button>
                             </div>
                        </div>
                    )}
                </div>
            );
        }

        function App() {
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);
            const [view, setView] = useState('seasons'); 
            const [appData, setAppData] = useState({ clubs: [], coaches: [], seasons: [] });
            const [dataLoading, setDataLoading] = useState(true);
            const [dataError, setDataError] = useState(null);
            const [filters, setFilters] = useState({ land: '', club: '' });
            const fetchAllData = useCallback(async () => { /* ... ongewijzigd ... */ }, []);
            useEffect(() => { /* ... ongewijzigd ... */ }, [fetchAllData]);
            const handleLogin = () => { /* ... ongewijzigd ... */ };
            const handleLogout = () => { /* ... ongewijzigd ... */ };
            
            // ... JSX voor App, met aangepaste navigatie ...
            if (authLoading) return <div>Laden...</div>;
            if (!user) return <div>Login...</div> // Vereenvoudigd voor leesbaarheid
            return (
                <div className="flex h-screen">
                    <aside className="w-64 bg-gray-800 text-white flex flex-col">
                         <div className="p-4 border-b border-gray-700"><h2 className="text-xl font-bold">Dashboard</h2><span className="text-sm text-gray-400">v12.0</span></div>
                        <nav className="flex-grow p-2">
                             <a href="#" onClick={(e) => {e.preventDefault(); setView('seasons');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'seasons' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><ListIcon /> Seizoenen Beheren</a>
                             <a href="#" onClick={(e) => {e.preventDefault(); setView('clubs');}} className={`flex items-center gap-3 px-3 py-2 rounded-md ${view === 'clubs' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><DatabaseIcon /> Clubs Beheren</a>
                            <a href="#" onClick={(e) => {e.preventDefault(); setView('coaches');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'coaches' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><UserIcon /> Coaches Beheren</a>
                            <a href="#" onClick={(e) => {e.preventDefault(); setView('cleanup');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'cleanup' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><ToolIcon /> Data Opschonen</a>
                            <a href="#" onClick={(e) => {e.preventDefault(); setView('wizard');}} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'wizard' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}><SparklesIcon /> Nieuw Land Wizard</a>
                        </nav>
                         <div className="p-4 border-t border-gray-700"><div className="flex items-center gap-2 mb-4"><img src={user.photoURL} alt={user.displayName} className="w-8 h-8 rounded-full" /><span className="text-sm font-medium">{user.displayName}</span></div><button onClick={handleLogout} className="w-full flex items-center justify-center gap-3 px-3 py-2 rounded-md bg-red-600 hover:bg-red-700"><LogOutIcon /> Uitloggen</button></div>
                    </aside>
                    <main className="flex-1 p-8 overflow-y-auto">
                        {dataLoading ? <div className="text-center">Database data aan het laden...</div> : 
                         dataError ? <div className="text-center text-red-500">{dataError}</div> :
                            {
                                'clubs': <ClubsView initialClubs={appData.clubs} onUpdate={fetchAllData} />,
                                'coaches': <CoachesView initialCoaches={appData.coaches} onUpdate={fetchAllData} />,
                                'seasons': <SeasonsView initialSeasons={appData.seasons} coaches={appData.coaches} clubs={appData.clubs} onUpdate={fetchAllData} filters={filters} setFilters={setFilters} />,
                                'cleanup': <DataCleanupView onUpdate={fetchAllData} />,
                                'wizard': <WizardView onUpdateAll={fetchAllData} />
                            }[view]
                        }
                    </main>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
