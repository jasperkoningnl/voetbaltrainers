<!DOCTYPE html>
<!-- Dashboard Versie: 9.0 - Volledig Club, Coach & Seizoen Beheer -->
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voetbaltrainers Data Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, writeBatch, updateDoc, query, where, addDoc, setDoc, deleteDoc, orderBy } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDZckphHLQiTK2KZHPOyPDxgB6glBr4HpY",
            authDomain: "voetbaltrainers.firebaseapp.com",
            projectId: "voetbaltrainers",
            storageBucket: "voetbaltrainers.appspot.com",
            messagingSenderId: "640532231483",
            appId: "1:640532231483:web:54d614b65b3e2c4adc731e",
            measurementId: "G-YQV6E3V2CK"
        };
        
        const app = initializeApp(firebaseConfig);
        window.firebaseServices = {
            auth: getAuth(app),
            db: getFirestore(app),
            GoogleAuthProvider,
            signInWithPopup,
            signInWithRedirect,
            signOut,
            onAuthStateChanged,
            collection, getDocs, doc, writeBatch, updateDoc, query, where, addDoc, setDoc, deleteDoc, orderBy
        };
    </script>
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;
        const { db, auth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, signOut, onAuthStateChanged, collection, getDocs, doc, writeBatch, updateDoc, query, where, addDoc, setDoc, deleteDoc, orderBy } = window.firebaseServices;

        // --- Iconen ---
        const DatabaseIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>;
        const UserIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>;
        const SparklesIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="m12 3-1.9 5.8-5.8 1.9 5.8 1.9 1.9 5.8 1.9-5.8 5.8-1.9-5.8-1.9Z"></path></svg>;
        const LogOutIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" x2="9" y1="12" y2="12"></line></svg>;
        const EditIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path></svg>;
        const SaveIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>;
        const CancelIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const ListIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg>;
        const TrashIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const PlusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-1"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('seasons'); 

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const handleLogin = () => {
                const provider = new GoogleAuthProvider();
                signInWithPopup(auth, provider).catch((error) => {
                    if (error.code === 'auth/operation-not-supported-in-this-environment' || 
                        error.code === 'auth/unauthorized-domain' ||
                        error.code === 'auth/cancelled-popup-request') {
                        signInWithRedirect(auth, provider);
                    } else {
                        console.error("Login Fout:", error);
                    }
                });
            };

            const handleLogout = () => {
                signOut(auth).catch(error => console.error("Logout Fout:", error));
            };

            if (loading) { return <div className="flex items-center justify-center h-screen"><p>Dashboard laden...</p></div> }
            if (!user) {
                return (
                    <div className="flex items-center justify-center h-screen bg-gray-200">
                        <div className="text-center bg-white p-10 rounded-lg shadow-xl">
                            <h1 className="text-3xl font-bold mb-2">Data Dashboard</h1>
                            <p className="text-gray-600 mb-6">Log in om de data te beheren.</p>
                            <button onClick={handleLogin} className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded inline-flex items-center">
                                <svg className="w-6 h-6 mr-2" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>
                                <span>Login met Google</span>
                            </button>
                        </div>
                    </div>
                );
            }
             return (
                <div className="flex h-screen">
                    <aside className="w-64 bg-gray-800 text-white flex flex-col">
                        <div className="p-4 border-b border-gray-700">
                            <h2 className="text-xl font-bold">Dashboard</h2>
                            <span className="text-sm text-gray-400">v9.0</span>
                        </div>
                        <nav className="flex-grow p-2">
                             <a href="#" onClick={() => setView('clubs')} className={`flex items-center gap-3 px-3 py-2 rounded-md ${view === 'clubs' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}>
                                <DatabaseIcon /> Clubs Beheren
                            </a>
                            <a href="#" onClick={() => setView('coaches')} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'coaches' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}>
                                <UserIcon /> Coaches Beheren
                            </a>
                             <a href="#" onClick={() => setView('seasons')} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'seasons' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}>
                                <ListIcon /> Seizoenen Beheren
                            </a>
                            <a href="#" onClick={() => setView('ai')} className={`flex items-center gap-3 px-3 py-2 mt-1 rounded-md ${view === 'ai' ? 'bg-gray-700' : 'hover:bg-gray-700'}`}>
                                <SparklesIcon /> AI Assistent
                            </a>
                        </nav>
                        <div className="p-4 border-t border-gray-700">
                            <div className="flex items-center gap-2 mb-4">
                                <img src={user.photoURL} alt={user.displayName} className="w-8 h-8 rounded-full" />
                                <span className="text-sm font-medium">{user.displayName}</span>
                            </div>
                            <button onClick={handleLogout} className="w-full flex items-center justify-center gap-3 px-3 py-2 rounded-md bg-red-600 hover:bg-red-700">
                               <LogOutIcon /> Uitloggen
                            </button>
                        </div>
                    </aside>
                    <main className="flex-1 p-8 overflow-y-auto" key={view}>
                        {
                            {
                                'clubs': <ClubsView />,
                                'coaches': <CoachesView />,
                                'seasons': <SeasonsView />,
                                'ai': <AiView />
                            }[view]
                        }
                    </main>
                </div>
            );
        }
        
        function ClubsView() {
            // ... (Onaangepast)
        }

        function CoachesView() {
           // ... (Onaangepast)
        }
        
        function SeasonsView() {
            const [seasons, setSeasons] = useState([]);
            const [coaches, setCoaches] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [filterLand, setFilterLand] = useState('All');
            const [searchTerm, setSearchTerm] = useState('');
            const [editingSeason, setEditingSeason] = useState(null);

            const coachesMap = useMemo(() => new Map(coaches.map(c => [c.id, c.naam])), [coaches]);
            const coachesSorted = useMemo(() => [...coaches].sort((a,b) => a.naam.localeCompare(b.naam)), [coaches]);

            const fetchSeasonsAndCoaches = useCallback(async () => {
                setLoading(true);
                setError(null);
                try {
                    const [seasonsSnapshot, coachesSnapshot] = await Promise.all([
                        getDocs(query(collection(db, "seizoenen"), orderBy("seizoen", "desc"))),
                        getDocs(collection(db, "coaches"))
                    ]);
                    
                    const coachesData = coachesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setCoaches(coachesData);

                    const seasonsData = seasonsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setSeasons(seasonsData);

                } catch (e) {
                    console.error("Fout bij ophalen data:", e);
                    setError("Kon de seizoenen niet laden.");
                }
                setLoading(false);
            }, []);

            useEffect(() => {
                fetchSeasonsAndCoaches();
            }, [fetchSeasonsAndCoaches]);
            
            const handleDelete = async (seasonId) => {
                if (window.confirm("Weet je zeker dat je dit seizoen wilt verwijderen? Dit kan niet ongedaan worden gemaakt.")) {
                    try {
                        await deleteDoc(doc(db, "seizoenen", seasonId));
                        setSeasons(prevSeasons => prevSeasons.filter(s => s.id !== seasonId));
                    } catch (e) {
                        console.error("Fout bij verwijderen:", e);
                        alert("Verwijderen mislukt. Zie console voor details.");
                    }
                }
            };
            
            const handleSave = async (seasonToSave) => {
                const { id, ...dataToSave } = seasonToSave;
                try {
                     await updateDoc(doc(db, "seizoenen", id), dataToSave);
                     setSeasons(prev => prev.map(s => s.id === id ? seasonToSave : s));
                     setEditingSeason(null);
                } catch(e) {
                    console.error("Fout bij opslaan:", e);
                    alert("Opslaan mislukt.");
                }
            }

            const filteredSeasons = useMemo(() => {
                return seasons.filter(s => {
                    const landMatch = filterLand === 'All' || s.land === filterLand;
                    const clubMatch = searchTerm === '' || s.club.toLowerCase().includes(searchTerm.toLowerCase());
                    return landMatch && clubMatch;
                });
            }, [seasons, filterLand, searchTerm]);
            
            if (loading) return <div>Data laden...</div>;
            if (error) return <div className="text-red-500">{error}</div>;

            return (
                 <div>
                    <h1 className="text-3xl font-bold mb-6">Seizoenen Beheren</h1>
                    <div className="bg-white p-6 rounded-lg shadow-md">
                        <div className="flex flex-wrap gap-4 mb-4 items-center">
                           <h2 className="text-xl font-semibold">Filters</h2>
                           <div>
                            <label htmlFor="land-filter" className="text-sm font-medium mr-2">Land:</label>
                            <select id="land-filter" onChange={(e) => setFilterLand(e.target.value)} value={filterLand} className="p-2 border rounded-md">
                                <option value="All">Alle Landen</option>
                                <option value="England">England</option>
                                <option value="Netherlands">Netherlands</option>
                            </select>
                           </div>
                           <div>
                             <label htmlFor="club-search" className="text-sm font-medium mr-2">Club:</label>
                             <input id="club-search" type="text" placeholder="Zoek op club..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="p-2 border rounded-md" />
                           </div>
                        </div>
                        <div className="overflow-x-auto">
                           <table className="w-full text-left">
                               <thead>
                                 <tr className="border-b">
                                   <th className="p-2">Seizoen</th>
                                   <th className="p-2">Club</th>
                                   <th className="p-2">Coach</th>
                                   <th className="p-2">Prijzen</th>
                                   <th className="p-2 w-28 text-right">Acties</th>
                                 </tr>
                               </thead>
                               <tbody>
                                 {filteredSeasons.map(season => (
                                     <React.Fragment key={season.id}>
                                        <tr className="border-b last:border-b-0 hover:bg-gray-50 align-top">
                                          <td className="p-2 font-mono">{season.seizoen}</td>
                                          <td className="p-2 font-medium">{season.club}</td>
                                          <td className="p-2 text-sm text-gray-600">{coachesMap.get(season.coachId)?.naam || 'Onbekend'}</td>
                                          <td className="p-2 text-xs font-mono">
                                            L: {season.landstitel || 'N'} | 
                                            B: {season.nationale_beker || 'N'} | 
                                            E: {season.europese_prijs || 'N'}
                                          </td>
                                          <td className="p-2 flex gap-2 justify-end">
                                            <button onClick={() => setEditingSeason(season)} className="p-1.5 bg-blue-500 text-white rounded-md hover:bg-blue-600"><EditIcon /></button>
                                            <button onClick={() => handleDelete(season.id)} className="p-1.5 bg-red-600 text-white rounded-md hover:bg-red-700"><TrashIcon /></button>
                                          </td>
                                        </tr>
                                        {editingSeason && editingSeason.id === season.id && (
                                            <tr>
                                                <td colSpan="5" className="p-4 bg-gray-50">
                                                    <EditSeasonForm 
                                                        season={editingSeason} 
                                                        coaches={coachesSorted}
                                                        onSave={handleSave}
                                                        onCancel={() => setEditingSeason(null)}
                                                    />
                                                </td>
                                            </tr>
                                        )}
                                     </React.Fragment>
                                 ))}
                               </tbody>
                           </table>
                        </div>
                    </div>
                </div>
            );
        }

        function EditSeasonForm({ season, coaches, onSave, onCancel }) {
            const [formData, setFormData] = useState(season);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({...prev, [name]: value }));
            }
            
            return (
                <div className="space-y-4">
                    <h3 className="text-lg font-semibold">Bewerk Seizoen: {season.club} {season.seizoen}</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                           <label className="block text-sm font-medium text-gray-700">Coach</label>
                           <select name="coachId" value={formData.coachId} onChange={handleChange} className="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                             {coaches.map(c => <option key={c.id} value={c.id}>{c.naam}</option>)}
                           </select>
                        </div>
                         <div>
                           <label className="block text-sm font-medium text-gray-700">Land</label>
                           <input type="text" name="land" value={formData.land} onChange={handleChange} className="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
                        </div>
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700">Prijzen</label>
                        <div className="flex gap-4 mt-1">
                           {['landstitel', 'nationale_beker', 'europese_prijs'].map(prize => (
                               <div key={prize} className="flex items-center">
                                 <label htmlFor={`${prize}-${season.id}`} className="mr-2 capitalize">{prize.replace('_', ' ')}:</label>
                                 <select id={`${prize}-${season.id}`} name={prize} value={formData[prize] || 'N'} onChange={handleChange} className="p-2 border rounded-md">
                                     <option value="Y">Y</option>
                                     <option value="N">N</option>
                                 </select>
                               </div>
                           ))}
                        </div>
                    </div>
                    <div className="flex justify-end gap-2">
                        <button onClick={onCancel} className="bg-gray-200 hover:bg-gray-300 text-black font-bold py-2 px-4 rounded">Annuleren</button>
                        <button onClick={() => onSave(formData)} className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Opslaan</button>
                    </div>
                </div>
            )
        }

        function AiView() {
            // ... (Onaangepast)
        }

        ReactDOM.render(<App />, document.getElementById('root'));

    </script>
</body>
</html>
